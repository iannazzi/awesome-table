<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'/>

    <title>Awesome Table</title>

    <script src='../../node_modules/jquery/dist/jquery.js'></script>
    <script src='../../dist/awesome-table-dist.js'></script>
    <!--need to run column definition class through webpack so I can use it..... -->
    <script src='globalDemoDist/columnDefinition.js'></script>
    <script src='globalDemoDist/dataGenerator.js'></script>

</head>
<body>
    <a href="index.html">Home</a>
    <h1>Purchase Order</h1>
    <div id='table'></div>
    <h1>Testing Results</h1>
    <div id='test_div'></div>
</body>
<script>

    //setup
    let awesomeTable = new AwesomeTable.AwesomeTable('collection');
    let column_definition = new columnDefinition.ColumnDefinition();
    let data_generator = new dataGenerator.DataGenerator();
    //we need a few events... these can attach to the column definition.....

    let updateTotal = function(event){
        //update total whenever quantity is changed or cost is changed....
        let r = awesomeTable.getRow(event.srcElement);

        let qty = awesomeTable.getValue('qty', r);
        let cost = awesomeTable.getValue('cost', r);
        let total = qty*cost;
        awesomeTable.setValue('total', r, total);
    }
    let updateQuantity = function(event){
        //update quantity whenever a size array value changes
        let r = awesomeTable.getRow(event.srcElement);
        let sum = awesomeTable.model.sumArray('sizes',r);
        //now set a value....
        awesomeTable.setValue('qty', r, sum);
        //call update total..... how?
        updateTotal(event);
    }
    let config = {
        name: 'awesomeTable',
        data: [], //data1.data.records,
        column_definition: column_definition.purchaseOrder(awesomeTable, updateQuantity, updateTotal),
        table_buttons: ['addRow','deleteRow','deleteAllRows', 'moveRows','copyRows', 'edit'],
        access: 'read', //read vs write
        onChange: function (args, r, c) {
            //we have access to this for any table changes....


//            console.log('active row using one method.... ' + awesomeTable.view.activeRow);
//            console.log('row ' + r);
//            console.log('col ' + c);
//
//            //here is the element that changed....
//            console.log('index of array : ' + args.element.array_index);
//            // I also have the column definition
//            console.log(args.col_def);

            //we can update quantites when the table changes


//            let sum = awesomeTable.model.sumArray('sizes',r);
//            //now set a value....
//            awesomeTable.setValue('qty', r, sum);
//            //now update the total for the line...
//            let cost = awesomeTable.getValue('cost', r);
//            let total = sum*cost;
//            awesomeTable.setValue('total', r, total);


        },
        onSaveClick(){
            let post_data = {data: awesomeTable.controller.getPostData(), _method: 'put'};
            console.log(JSON.stringify(post_data))
            awesomeTable.controller.makeReadable();

        },
        onSaveSuccess(){
            alert('saved')
        },
        onDeleteClick(){
            alert('delete');
        },
        onDeleteSuccess(){
            alert('deleted');
        },
        onCreateSaved(id){
            alert('deleted');
        },
        onCancelClick(){
            //cancel create, cancel edit, anything else?
            alert('canceled');
        },
        onCancelCreateClick(){
            alert('canceled');
        },

    }
    console.log(config);
    awesomeTable.loadConfiguration(config);
    awesomeTable.addTo('table')


    //test
    //load data




    //edit
    awesomeTable.controller.makeEditable();

    //enter data to model

    //add a row

    //add a row of data

    //move row up

    //move row down

    //copy row




    //get a value on the page from the element name - this will get messed up if the cd position is changed
    let value = document.getElementById('awesomeTable_r0c3').value;
    //get the same value from the model ... this looks stable
    let value2 = awesomeTable.getValue('sizes', 0);



    console.log(value2);
    let p = document.createElement('p');
    p.id = 'test1';
    p.innerHTML = value;
    test_div.appendChild(p);

    //add a row
    awesomeTable.view.addRowClicked.notify();

    //now check the quantity




</script>
</html>
<style>
    body{ margin:30px;}
</style>