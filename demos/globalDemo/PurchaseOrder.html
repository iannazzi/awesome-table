<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'/>

    <title>Awesome Table</title>

    <script src='../../node_modules/jquery/dist/jquery.js'></script>
    <script src='../../dist/awesome-table-dist.js'></script>
    <!--need to run column definition class through webpack so I can use it..... -->
    <script src='globalDemoDist/columnDefinition.js'></script>
    <script src='globalDemoDist/dataGenerator.js'></script>

</head>
<body>
    <a href="index.html">Home</a>
    <h1>Purchase Order</h1>
    <div id='table'></div>
    <h1>Testing Results</h1>
    <div id='test_div'></div>
</body>
<script>

    //setup
    let data = [];
    let awesomeTable = new AwesomeTable.AwesomeTable('collection');
    //we need to define some callbacks to pass to the column defintion.... thinks like update quantity and total...
    let updateTotal = function(row)
    {
       //this needs to be called
        //when the cost is updated
        //when the quantity is updated
        //when the table is draw

        //update total wheneverow quantity is changed orow cost is changed....
        let qty = awesomeTable.getValue('qty', row);
        let cost = awesomeTable.getValue('cost', row);
        let total = qty*cost;
        awesomeTable.setValue('total', row, total);
    }
    let updateQuantity = function(row){
        //update quantity whenever a size array value changes
        let sum = awesomeTable.model.sumArray('sizes',row);
        //now set a value....
        awesomeTable.setValue('qty', row, sum);
        //call update total..... how?
        updateTotal(row);
    }

    //add in row calculations....

    let column_definition = new columnDefinition.ColumnDefinition().purchaseOrder(awesomeTable, updateQuantity, updateTotal);
    let data_generator = new dataGenerator.DataGenerator();

    let config = {
        name: 'awesomeTable',
        data,
        column_definition,
        row_calculations: [updateQuantity, updateTotal], //fired on .draw() good for updating cell values
        table_buttons: ['addRow','deleteRow','deleteAllRows', 'moveRows','copyRows', 'edit'],
        access: 'read', //read vs write
        onChange: function (args, r, c) {
            //we have access to this for any table changes....


//            console.log('active row using one method.... ' + awesomeTable.view.activeRow);
//            console.log('row ' + r);
//            console.log('col ' + c);
//
//            //here is the element that changed....
//            console.log('index of array : ' + args.element.array_index);
//            // I also have the column definition
//            console.log(args.col_def);

            //we can update quantites when the table changes


//            let sum = awesomeTable.model.sumArray('sizes',r);
//            //now set a value....
//            awesomeTable.setValue('qty', r, sum);
//            //now update the total for the line...
//            let cost = awesomeTable.getValue('cost', r);
//            let total = sum*cost;
//            awesomeTable.setValue('total', r, total);


        },
        onSaveClick(){
            let post_data = {data: awesomeTable.controller.getPostData(), _method: 'put'};
            console.log(JSON.stringify(post_data))
            awesomeTable.controller.makeReadable();

        },
        onSaveSuccess(){
            alert('saved')
        },
        onDeleteClick(){
            alert('delete');
        },
        onDeleteSuccess(){
            alert('deleted');
        },
        onCreateSaved(id){
            alert('deleted');
        },
        onCancelClick(){
            //cancel create, cancel edit, anything else?
            alert('canceled');
        },
        onCancelCreateClick(){
            alert('canceled');
        },

    }
    //once everything is defined we can load up the config then render.....
    awesomeTable.loadConfiguration(config);
    awesomeTable.addTo('table')


    //test
    let handeled_errors = [];
    let page_errors = [];
    let expect_false,expect_true;


    //redraw

    //update values

    //update custom calculations....


    //load data
    data = data_generator.purchaseOrder(1);
    expect_false = awesomeTable.addDataRow(data);
    //here we would want to check check_data_is_a_row == false
    if(! expect_false){
        handeled_errors.push('addDataRow error data is an array not a row')
    }
    awesomeTable.addDataRow(data[0]);


    //check values are in the model...
    let total = awesomeTable.getValue('total', 1);
    console.log('total ' + total);

    //

    //check that values are written to the page....

    //get my own element....
    let total_element = awesomeTable.getElement('total',0)

    //how to get it by id?
    //    let total_text = document.getElementById('awesomeTable_r0c3').value;


//    data = data_generator.purchaseOrder(4);
//    awesomeTable.addDataArray(data);
//    let check_data_is_an_array = awesomeTable.addDataArray(data[0]);
//    if(! check_data_is_an_array){
//        handeled_errors.push('addDataArray error data is a not an array')
//    }
//
//    //check that we can get a value
//    //check that we can set a value
//
//
//    //edit
//    awesomeTable.controller.makeEditable();

    //enter data to model

    //add a row
    awesomeTable.view.addRowClicked.notify();
    //add a row of data

    //move row up

    //move row down

    //copy row




//    //get a value on the page from the element name - this will get messed up if the cd position is changed
//    let value = document.getElementById('awesomeTable_r0c3').value;
//    //get the same value from the model ... this looks stable
//    let value2 = awesomeTable.getValue('sizes', 0);


//
//    let p = document.createElement('p');
//    p.id = 'test1';
//    p.innerHTML = value;
//    test_div.appendChild(p);
//


    //now check the quantity




</script>
</html>
<style>
    body{ margin:30px;}
</style>