!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AwesomeTable=t():e.AwesomeTable=t()}(window,function(){return function(e){var t={};function a(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){"use strict";function o(e,t){if(""==function(e){for(e=(e+="").replace("\t","");" "==e.substring(0,1);)e=e.substring(1,e.length);for(;" "==e.substring(e.length-1,e.length);)e=e.substring(0,e.length-1);return e}(e)&&(e=0),isNaN(e))return e;{let a=parseFloat(e);return(a=Math.round(e*Math.pow(10,t))/Math.pow(10,t)).toFixed(t)}}function l(e){return""==e||"0"==e||"null"==e||null==e?0:parseFloat(e)}a.r(t);class d{constructor(e){this._sender=e,this._listeners=[]}attach(e){this._listeners.push(e)}notify(e){for(let t=0;t<this._listeners.length;t+=1)this._listeners[t](this._sender,e)}}class n{constructor(e){this.model=e}getTimeValue(e){return e&&e.indexOf("T")?e.substring(e.indexOf("T")+1,e.length):e}getDateValue(e){return e?e.substring(0,10):e}writeCellValue(e,t,a){if(this.checkRead())"id"==e.type?(t.innerHTML=a,t.classList.add("awesome_table_record_id"),void 0!==e.onClick&&t.addEventListener("click",function(){e.onClick(a)})):"date"==e.type?t.innerHTML=this.getDateValue(a):"time"==e.type?t.innerHTML=this.getTimeValue(a):"link"==e.type?t.innerHTML='<a href="'+a+'">'+a+"</a>":t.innerHTML=a;else{let o=t.childNodes[0];"row_checkbox"==e.type||"checkbox"==e.type||"radio"==e.type?o.checked=1==a:"row_number"==e.type?t.innerHTML=a:"link"==e.type?t.innerHTML=a:"time"==e.type?o.value=this.getTimeValue(a):"date"==e.type?o.value=this.getDateValue(a):o.value=a}}checkWrite(){let e=!1;return"WRITE"==this.model.td.access.toUpperCase()&&(e=!0),e}checkRead(){return!this.checkWrite()}drawTableEditSaveButtons(){this.edit_button_div.innerHTML="",this.checkRead()?(this.model.td.table_buttons.includes("delete")&&this.edit_button_div.appendChild(this.createDeleteButton()),this.model.td.table_buttons.includes("edit")&&this.edit_button_div.appendChild(this.createEditButton())):this.model.td.table_buttons.includes("edit")&&(this.edit_button_div.appendChild(this.createCancelButton()),this.edit_button_div.appendChild(this.createSaveButton()))}createElement(e,t,a,o){this.r=a,this.c=o;t.db_field;switch(t.type.toLowerCase()){case"date":return this.createDateInput(t);case"text":return this.createTextInput(t);case"password":return this.createPasswordInput(t);case"textarea":return this.createTextArea(t);case"number":return this.createNumberInput(t);case"checkbox":return this.createCheckBox(t);case"row_checkbox":return this.createRowCheckbox(t);case"row_number":return this.createRowNumber(t);case"select":return this.createDataTableSelect(t);case"tree_select":return this.createDataTableTreeSelect(t);case"html":return this.createTextNode(t);case"radio":return this.createRadio(t);case"button":return this.createButton(t);case"link":return this.createLink(t);case"id":return this.createId(t);case"time":return this.createTime(t);default:return document.createTextNode('type "'+t.type+'" has not been coded')}}createTextArea(e){if(this.checkWrite()){let t=document.createElement("TEXTAREA"),a=this;return t.addEventListener("keyup",function(){a.addInputChangedNotify(t,e)}),this.addEvents(e,t),this.addProperties(e,t),t}return document.createTextNode("")}createCheckBox(e){let t=document.createElement("input");t.type="checkbox";let a=this;return t.addEventListener("change",function(){a.addInputChangedNotify(t,e)}),this.addEvents(e,t),this.checkWrite()?this.addProperties(e,t):t.disabled=!0,t}createRowCheckbox(e){if(this.checkWrite()){let t=document.createElement("input");t.type="checkbox";let a=this;return t.addEventListener("click",function(){a.addInputChangedNotify(t,e)}),this.addEvents(e,t),this.addProperties(e,t),t}}createRowNumber(e){return document.createTextNode("")}createNumberInput(e){if(this.checkWrite()){let t=document.createElement("input");t.type="number",t.pattern="[0-9. -]*";let a=this;return t.addEventListener("keyup",function(){a.addInputChangedNotify(t,e)}),t.addEventListener("click",function(){a.addInputChangedNotify(t,e)}),t.addEventListener("change",function(){a.addInputChangedNotify(t,e)}),this.addEvents(e,t),this.addProperties(e,t),this.addMinMax(e,t),e.round,t}return e.round,document.createTextNode("")}addMinMax(e,t){void 0!==e.min&&(t.min=e.min),void 0!==e.max&&(t.max=e.max)}createTextInput(e){if(this.checkWrite()){let t=document.createElement("input");t.type="text",void 0!==e.placeholder&&e.placeholder&&(t.placeholder=e.placeholder);let a=this;return t.addEventListener("keyup",function(){a.addInputChangedNotify(t,e)}),t.addEventListener("click",function(){a.addInputChangedNotify(t,e)}),this.addEvents(e,t),this.addProperties(e,t),t}return document.createTextNode("")}createPasswordInput(e){if(this.checkWrite()){let t=document.createElement("input");t.type="password",t.name=e.db_field+"[]";let a=this;return t.addEventListener("keyup",function(){a.addInputChangedNotify(t,e)}),this.addEvents(e,t),this.addProperties(e,t),t}return document.createTextNode("")}createDateInput(e){if(this.checkWrite()){let t=document.createElement("input");t.type="date",void 0!==e.placeholder&&e.placeholder&&(t.placeholder=e.placeholder);let a=this;return t.addEventListener("change",function(){a.addInputChangedNotify(t,e)}),this.addEvents(e,t),t}return document.createTextNode("")}createTime(e){if(this.checkWrite()){let t=document.createElement("input");t.type="time",void 0!==e.placeholder&&e.placeholder&&(t.placeholder=e.placeholder);let a=this;return t.addEventListener("keyup",function(){a.addInputChangedNotify(t,e)}),t.addEventListener("click",function(){a.addInputChangedNotify(t,e)}),this.addEvents(e,t),this.addProperties(e,t),t}return document.createTextNode("")}createLink(e){if("index"==this.model.td.table_view){let t=document.createElement("a"),a=document.createTextNode("");return t.appendChild(a),"function"==typeof e.onClick&&t.addEventListener("click",function(){e.onClick()}),t}return this.createTextNode("")}createId(e){if("index"==this.model.td.table_view){let t=document.createElement("a"),a=document.createTextNode("");return t.appendChild(a),"function"==typeof e.onClick&&t.addEventListener("click",function(){}),t}return this.createTextNode(e)}createButton(e){let t=document.createElement("button");if(t.className="button",void 0!==e.button_caption){let a=document.createTextNode(e.button_caption);t.appendChild(a)}return this.addEvents(e,t),this.addProperties(e,t),t}createTextNode(e){return document.createTextNode("")}createRadio(e){let t=document.createElement("input");t.type="radio",t.name=e.db_field+"[]";let a=this;return t.addEventListener("onclick",function(){a.addInputChangedNotify(t,e)}),this.addEvents(e,t),this.checkWrite()?this.addProperties(e,t):t.disabled=!0,t}addInputChangedNotify(e,t){let a={};a.r=this.r,a.c=this.c,a.element=e,a.col_def=t,this.inputChanged.notify(a)}addEvents(e,t){let a={};if(a.r=this.r,a.c=this.c,a.col_def=e,void 0!==e.events)for(var o in e.events)e.events.hasOwnProperty(o)&&t.addEventListener(o,function(t){(0,e.events[o])(t,a)})}addProperties(e,t){void 0!==e.properties&&e.properties.forEach(e=>{for(let a in e)t[a]=e[a],"readOnly"==a&&(t.tabIndex="-1")})}createDataTableSelect(e){if(void 0===e.select_values)return console.log("select_values are not defined"),document.createTextNode("error select_values are not defined");if(this.checkWrite()){let t=this.createSelect(e),a=this;return void 0!==e.individual_select_options?t.onchange=function(){a.individualSelectChanged.notify()}:t.onchange=function(){a.inputChanged.notify()},this.addProperties(e,t),this.addEvents(e,t),t}return document.createTextNode("")}createSelect(e){let t=document.createElement("select"),a=document.createElement("option");return a.value="null",a.appendChild(document.createTextNode("Select...")),t.appendChild(a),e.select_values.forEach(e=>{(a=document.createElement("option")).value=e.value+"",a.appendChild(document.createTextNode(e.name+"")),t.appendChild(a)}),t}findTreeSelectValue(e,t){for(let a=0;a<e.length;a++){if(t==e[a].value)return e[a].name;let o=!1;if(void 0!==e[a].children&&(o=this.findTreeSelectValue(e[a].children,t)),o)return o}}createDataTableTreeSelect(e){if(this.checkWrite()){let t=this.createTreeSelect(e),a=this;return t.onchange=function(){a.inputChanged.notify()},this.addProperties(e,t),t}return document.createTextNode("")}createTreeSelect(e){let t=document.createElement("select"),a=document.createElement("option");a.value="null",a.appendChild(document.createTextNode("Select...")),t.appendChild(a);return this.addNestedSelectOptions(t,e.select_values,0),t}addNestedSelectOptions(e,t,a){t.forEach((t,o)=>{let i=document.createElement("option");i.value=t.value;let l=t.name;for(let e=0;e<a;e++)l="-"+(l=" "+(l=" "+l));i.appendChild(document.createTextNode(l)),e.appendChild(i),void 0!==t.children&&this.addNestedSelectOptions(e,t.children,a+1)})}createEditButton(){let e=this,t=document.createElement("button");return t.innerHTML="Edit",t.className="edit",t.classList.add("button"),t.onclick=function(){e.onEditClick.notify()},this.editButton=t,t}createCancelButton(){let e=document.createElement("button"),t=this;return e.innerHTML="Cancel",e.className="cancel",e.classList.add("button"),e.onclick=function(){t.onCancelClick.notify()},this.cancelButton=e,e}createDeleteButton(){let e=this,t=document.createElement("button");return t.innerHTML="Delete",t.onclick=function(){e.onDeleteClick.notify()},t.className="delete",t.classList.add("button"),this.deleteButton=t,t}createSaveButton(){let e=document.createElement("button");e.innerHTML="Save",e.className="save",e.classList.add("button");let t=this;return e.onclick=function(){t.onSaveClick.notify()},this.saveButton=e,e}createNewButton(e){let t=document.createElement("button");t.className="btn-new";let a=this;return t.onclick=function(){window.location.href=a.model.td.route+"/create"},t.innerHTML='<i class="fa fa-plus" aria-hidden="true"></i>'+e,t}showWaitModal(e=!0){e?$(this.waitModal).modal("show"):$(this.waitModal).modal("hide")}showConfirmModal(e=!0){e?$(this.confirmModal).modal("show"):$(this.confirmModal).modal("hide")}hideErrorModal(){this.errorModal.hide()}showErrorModal(e){this.errorModal.addErrorMessage(e),this.errorModal.show()}}class r extends n{constructor(e){super(e),this.elements_array=[]}createRecordTable(){let e=this.model.td.name;return this.recordTableDiv=this.createRecordTableDiv(),this.table=this.createTableElement(e),this.recordTableDiv.appendChild(this.table),this.recordTableDiv.appendChild(this.createButtons()),this.drawTable(),this.recordTableDiv}createButtons(){let e=document.createElement("div");return e.id=this.id+"_buttons",e.className="record_table_buttons",this.edit_button_div=e,e}createRecordTableDiv(){let e=document.createElement("div");return e.className="record_table_div",e.id=this.name+"_table_div",e}createTableElement(e){let t=document.createElement("table");return t.id=e+"_table",t.classList.add("awesome-record-table"),t.classList.add("table"),t}drawTable(){this.drawTbody(),this.drawTableEditSaveButtons(),this.updateTableValues()}drawTbody(){let e=this.table;e.innerHTML="",this.elements=[],this.elements[0]={},this.elements_array=[],this.tbody_cells=[];let t=document.createElement("tbody");e.appendChild(t),this.tbody=t,this.model.cdo.forEach(e=>{switch(this.model.td.table_view){case"create":(void 0===e.show_on_create||e.show_on_create)&&this.addRow(t,e);break;case"edit":(void 0===e.show_on_edit||e.show_on_edit)&&this.addRow(t,e);break;case"show":(void 0===e.show_on_view||e.show_on_view)&&this.addRow(t,e);break;default:console.log("error in the column definition - table_view was not set....")}})}updateTableValues(){this.updateRowValues(0)}updateRowValues(e=0){let t=this.tbody_cells;for(let a=0;a<t.length;a++){let o=t[a].col_def,i=this.model.tdo[e][o.db_field].data;this.writeCellValue(o,t[a],i)}}updateTotals(){}addRow(e,t){if("row_checkbox"!=t.type&&"row_number"!=t.type){let a=e.insertRow(),o=document.createElement("th"),i=t.db_field;t.caption&&(i=t.caption),o.innerHTML=i,a.appendChild(o);let l=this.model.tdo[0][t.db_field].data,d=a.insertCell(-1);d.id=this.model.td.name+"_td_"+t.db_field,this.tbody_cells.push(d),d.col_def=t;let n=this.createElement(l,t);n.id=this.model.td.name+"_"+t.db_field,n.awesomeTable={},n.awesomeTable.col_def=t,this.elements[0][t.db_field]=n,this.elements_array.push(n),d.appendChild(n)}}updateTotalsRow(){}updateFooter(){}showRowModifyButtons(){}hideRowModifyButtons(){}}class s{constructor(e){this.model=e}developerAlert(e){console.log("Developer Alert! \n"+e)}updateCellValue(e,t,a){this.model.tdo[t][e].data=a,this.view.updateRowValues(t),this.view.updateTotals()}findElement(e){for(let t=0;t<this.view.tbody_cells.length;t++){let a=this.view.tbody_cells[t];for(let o=0;o<a.length;o++)if(a[o].td.childNodes[0]==e)return[t,o]}return!1}getElementRow(e){let t=e.name.substring("element_".length);return parseInt(t.substr(t.indexOf("r")+1,t.indexOf("c")-1))}getElementColumn(e){let t=e.name.substring("element_".length);return t.substr(t.indexOf("c")+1,t.length)}copyElementValueToModel(e,t,a,o=!1){if(this.view.checkWrite())if("row_checkbox"==t.type||"checkbox"==t.type||"radio"==t.type){let i=0;e.checked&&(i=1),!1===o?this.model.tdo[a][t.db_field].data=i:this.model.tdo[a][t.db_field].data[o]=i}else"text"!=t.type&&"number"!=t.type&&"password"!=t.type&&"select"!=t.type&&"tree_select"!=t.type&&"textarea"!=t.type&&"date"!=t.type||(!1===o?this.model.tdo[a][t.db_field].data=e.value:this.model.tdo[a][t.db_field].data[o]=e.value)}getPostData(){let e=[];return this.model.tdo.forEach((t,a)=>{e[a]={},this.model.cdo.forEach((o,i)=>{(void 0===o.post||o.post)&&(e[a][o.db_field]=t[o.db_field].data)})}),e}makeEditable(){this.model.td.table_view="edit",this.model.td.access="write",this.view.drawTable(),this.view.showRowModifyButtons(),this.setFocusToFirstInput()}makeReadable(){this.model.td.table_view="show",this.model.td.access="read",this.view.drawTable(),this.view.hideRowModifyButtons(),this.setFocusToFirstInput()}setFocusToFirstInput(e){let t=this.view.elements_array;for(let e=0;e<t.length;e++){if("text"==t[e].type||"number"==t[e].type||"textarea"==t[e].type||"date"==t[e].type){t[e].focus();break}if("select-one"==t[e].type||"select-multi"==t[e].type){t[e].focus();break}}}}class c{constructor(e){let t=e.view;e.model;t.onSaveClick=new d(t),e.view.onSaveClick.attach(function(){if("function"==typeof e.model.td.onSaveClick)return e.model.td.onSaveClick()})}}class h extends c{constructor(e){super(e);let t=e.view;e.loadPageEvent=new d(e),e.loadPageEvent.attach(function(){console.log("load page event...")}),t.individualSelectChanged=new d(t),e.view.individualSelectChanged.attach(function(){e.copyTable()}),t.inputChanged=new d(t),e.view.inputChanged.attach(function(t,a){console.log("input changed"),e.copyTable(),"function"==typeof e.model.td.onChange&&e.model.td.onChange(a)}),t.onEditClick=new d(t),e.view.onEditClick.attach(function(){"function"==typeof e.model.td.onEditClick?(e.model.td.onEditClick(),console.log("using custom onEditClick"),console.log(e.model.td)):(console.log("using reg onEditClick"),e.makeEditable())}),t.onCancelClick=new d(t),t.onCancelClick.attach(function(){switch(e.model.td.table_view){case"edit":e.onCancelEdit();break;case"create":e.onCancelCreate()}}),e.onSaveSuccess=new d(e),e.onSaveSuccess.attach(function(a,o){switch(console.log(e.model.td.table_view),e.model.td.table_view){case"create":"function"==typeof e.model.td.onCreateSaved?e.model.td.onCreateSaved(o.id):alert("add onCreateSaved to table options");break;case"edit":e.model.td.table_view="show",e.model.td.access="read",e.model.original_data=e.getPostData(),t.drawTable()}e.saveComplete.notify()}),e.saveComplete=new d(e),t.onDeleteClick=new d(t),t.onDeleteClick.attach(function(){"function"==typeof e.model.td.onDeleteClick&&e.model.td.onDeleteClick()})}}class u extends s{constructor(e,t){super(e),this.view=t,this.events=new h(this)}onCancelCreate(){if("function"==typeof this.model.td.onCancelCreateClick)return this.model.td.onCancelCreateClick()}onCancelEdit(){this.model.loadBackupData(),this.model.td.table_view="show",this.model.td.access="read",this.view.drawTable()}getSelectValueName(e,t){t=parseInt(t);let a=!1,o=this.model.getCDOColumnNumberFromName(e);return this.model.cdo[o].select_values.forEach(e=>{parseInt(e.value)==t&&(a=e.name)}),a}loadRecord(e){this.model.loadData([e]),this.view.updateTableValues()}copyTable(){this.model.cdo.forEach(e=>{if("row_checkbox"!=e.type&&"row_number"!=e.type){let t=this.view.elements[0][e.db_field];switch(this.model.td.table_view){case"create":!1!==e.show_on_create&&this.copyElementValueToModel(t,e,0);break;case"edit":!1!==e.show_on_edit&&this.copyElementValueToModel(t,e,0)}}})}getConfirm(e,t){e=e||"",self=this,this.view.showConfirmModal(!0),$("#confirmMessage").html(e),$("#confirmFalse").click(function(){$(self.view.confirmModal).modal("hide"),t&&t(!1)}),$("#confirmTrue").click(function(){$(self.view.confirmModal).modal("hide"),t&&t(!0)})}checkWrite(){let e=!1;return"WRITE"==this.model.td.access.toUpperCase()&&(e=!0),e}checkRead(){return!this.checkWrite()}}class m extends n{constructor(e){super(e),this.header_elements_array=[],this.header_elements={},this.footer_elements={},this.total_row_elements={}}createCollectionTable(){let e=this.model.td.name;return this.collectionTableDiv=this.createCollectionTableDiv(),this.table=this.createTable(e),this.collectionTableDiv.appendChild(this.table),this.table_modify_div=this.createTableModifyDiv(),this.collectionTableDiv.appendChild(this.table_modify_div),this.edit_button_div=this.createEditButtonDiv(),this.collectionTableDiv.appendChild(this.edit_button_div),this.drawTable(),this.collectionTableDiv}createCollectionTableDiv(){let e=document.createElement("div");return e.addEventListener("keyup",function(e){13==e.which&&console.log("enter pressed")}),e}createTable(e){let t=document.createElement("table");return t.id=e+"_table",t.classList.add("awesome-collection-table"),t.classList.add("table"),t.appendChild(this.createThead(e)),t.appendChild(this.createTotalsBody(e)),this.createTBody(e),t.appendChild(this.tbody),t.appendChild(this.createTFoot(e)),t}createThead(e){let t=document.createElement("thead");return t.id=e+"_thead",this.thead=t,t}isTableReadAndColumnRowCheckbox(e){return!(!this.checkWrite()&&"row_checkbox"==e.type)}showOnList(e){return!(void 0!==e.show_on_list&&!e.show_on_list)}drawThead(){let e=this;this.checkTHeaderArray(),this.thead.innerHTML="",this.header_elements_array=[];let t=[];for(let e=0;e<this.header_row_span;e++)t[e]=this.thead.insertRow();let a="";this.model.cdo.forEach(o=>{if(this.showOnList(o)&&this.isTableReadAndColumnRowCheckbox(o))if(a="",void 0!==o.caption&&(a=o.caption),void 0!==o.caption&&Array.isArray(o.caption)){let a=[];o.caption.forEach((i,l)=>{a[l]=[],i.forEach((i,d)=>{let n=document.createElement("th");n.innerHTML=i,a[l][d]=n,n.addEventListener("click",function(t){e.onHeaderArrayClick.notify({e:t,col_def:o})}),this.th_width(o,n),t[l].appendChild(n)})}),this.header_elements_array.push(a),this.header_elements[o.db_field]=a}else{let i=document.createElement("th");i.col_def=o,i.id=o.db_field+"_header",i.sort=0,i.addEventListener("click",function(t){e.onHeaderClick.notify([t,i])});let l=document.createElement("p");l.innerHTML=a,i.appendChild(l);let d=document.createElement("i");d.className="fa fa-sort",i.appendChild(d),this.th_width(o,i),i.rowSpan=this.header_row_span,t[0].appendChild(i),this.header_elements_array.push(i),this.header_elements[o.db_field]=i}}),this.updateHeaderSortView()}th_width(e,t){"row_number"==e.db_field&&(t.style.width="30px"),"row_checkbox"==e.db_field&&(t.style.width="30px"),void 0!==e.width&&(t.style.width=e.width)}getHeaderCaption(e){let t=this.model.getColDef(e),a=e;return void 0!==t.caption&&(a=t.caption),a}updateHeaderSortView(){for(var e in this.header_elements){let t=this.header_elements[e];Array.isArray(t)||(t.innerHTML=this.getHeaderCaption(e),t.classList.remove("thHighlight"),t.sort=0)}let t=this;this.model.sort.forEach(e=>{let a=Object.keys(e)[0],o=t.header_elements[a];switch(e[a]){case"asc":o.innerHTML=this.getHeaderCaption(a)+" &and;",o.className="thHighlight",o.sort=1;break;case"desc":o.innerHTML=this.getHeaderCaption(a)+" &or;",o.className="thHighlight",o.sort=2}})}checkTHeaderArray(){this.header_row_span=1,this.model.cdo.forEach((e,t)=>{!1!==e.show_on_list&&void 0!==e.caption&&e.caption.constructor===Array&&(this.header_row_span=e.caption.length,this.array_col=t)})}createTotalsBody(e){return this.total_tbody=document.createElement("tbody"),this.total_tbody.id=e+"_data_totals_tbody",this.total_tbody.classList.add("awesome-collection-table-totals"),this.total_tbody}drawTotalsRow(){this.total_tbody.innerHTML="";let e=!1;if(this.model.cdo.forEach(t=>{void 0!==t.total&&(e=!0)}),e){let e=this.total_tbody.insertRow();e.className="generalTableTotalsRow",e.style.backgroundColor="yellow";let t=!1,a=0;this.model.cdo.forEach(o=>{if(this.checkRead()&&this.isRowCheckbox(o));else if(this.isTotalCol(o)){let t=e.insertCell(a);t.id=this.model.td.name+"_totalrow_"+o.db_field,a++,this.total_row_elements[o.db_field]=t}else if(void 0!==o.caption&&o.caption.constructor===Array)o.caption[0].forEach((t,i)=>{e.insertCell(a).id=this.model.td.name+"_totalrow_"+o.db_field+i,a++});else{let i=e.insertCell(a);i.id=this.model.td.name+"_totalrow_"+o.db_field,a++,t||(i.innerHTML="TOTALS",t=!0)}})}}isRowCheckbox(e){return"row_checkbox"==e.type}isTableReadAndColRowCheckbox(e){}isTotalCol(e){return!1!==e.show_on_list&&void 0!==e.total}updateTotalsRow(){let e;this.model.cdo.forEach(t=>{this.isTotalCol(t)&&(e=this.model.sumColumn(t.db_field),this.total_row_elements[t.db_field].innerHTML=o(e,t.total))})}createTBody(e){return this.tbody=document.createElement("tbody"),this.tbody.id=e+"_data_tbody",this.tbody.classList.add("awesome-collection-table-tbody"),this.tbody}drawTbody(){this.tbody.innerHTML="",this.rows=[],this.cells_by_name=[],this.elements_array=[],this.tbody_cells=[];for(let e=0;e<this.model.tdo.length;e++)this.drawTbodyRow(e);this.checkWrite()&&this.updateIndividualSelectOptions()}drawTbodyRow(e){this.cells_by_name[e]={},this.elements_array[e]=[],this.tbody_cells[e]=[];let t=this.tbody.insertRow();t.id=this.model.td.name+"_r"+e;let a=this;t.addEventListener("click",function(){a.onRowClick.notify(t)}),this.rows[e]=t;let o=0;this.model.cdo.forEach(a=>{!1!==a.show_on_list&&(this.checkRead()&&this.isRowCheckbox(a)||(o=this.createColumn(t,e,a,o)))})}createColumn(e,t,a,o){let i;return this.isColArray(a)?(this.cells_by_name[t][a.db_field]=[],a.caption[0].forEach((l,d)=>{(i=this.createCell(e,a,t,o,d)).id=this.model.td.name+"_r"+t+"_"+a.db_field+o,this.updateCellArray(t,o,i,a,d),o++})):((i=this.createCell(e,a,t,o)).id=this.model.td.name+"_r"+t+"_"+a.db_field,this.updateCellArray(t,o,i,a),o++),o}createCell(e,t,a,o,i="undefined"){let l=this,d=this.createElement(null,t,a,o);d.addEventListener("focus",function(){l.activeRow=e.sectionRowIndex}),d.id="undefined"!==i?this.model.td.name+"_td_r"+a+"_"+t.db_field+i:this.model.td.name+"_td_r"+a+"_"+t.db_field;let n=e.insertCell(-1);return n.appendChild(d),n}updateCellArray(e,t,a,o,i=!1){!1!==i?this.cells_by_name[e][o.db_field][i]=a:this.cells_by_name[e][o.db_field]=a,this.elements_array[e][t]=a,this.tbody_cells[e][t]={},this.tbody_cells[e][t].col_def=o,this.tbody_cells[e][t].td=a}createTFoot(e){let t=document.createElement("tfoot");return this.tfoot=t,t}drawFooter(){this.tfoot.innerHTML="";let e,t=0;if(this.model.cdo.forEach(e=>{!1!==e.show_on_list&&void 0!==e.footer&&(this.footer_elements[e.db_field]=[],e.footer.length>t&&(t=e.footer.length))}),0!=t)for(let a=0;a<t;a++){e=document.createElement("tr");let t,o=0;this.model.cdo.forEach(i=>{this.showOnList(i)&&this.isTableReadAndColumnRowCheckbox(i)&&(t=document.createElement("td"),void 0!==i.footer&&void 0!==i.footer[a]?(o>0&&(t=document.createElement("td"),e.appendChild(t),t.classList.add("at-footer-label"),t.colSpan=o,t.innerHTML=i.footer[a].caption,o=0),(t=document.createElement("td")).classList.add("at-footer-data"),t.id=this.model.td.name+"_footer_"+i.db_field+a,e.appendChild(t),this.footer_elements[i.db_field][a]=t):Array.isArray(i.caption)?o+=i.caption[0].length:o++)}),this.tfoot.appendChild(e)}}updateFooter(){this.model.cdo.forEach(e=>{if(void 0!==e.footer)for(let t=0;t<e.footer.length;t++)void 0!==e.footer[t].round?this.footer_elements[e.db_field][t].innerHTML=o(e.footer[t].getValue(),e.footer[t].round):this.footer_elements[e.db_field][t].innerHTML=e.footer[t].getValue()})}checkRows(e){for(let t,a=0;t=this.tbody.rows[a];a++)if(e.indexOf(a)>-1){let e=t.cells[0];void 0!==e.childNodes[0]&&"checkbox"==e.childNodes[0].type&&(e.childNodes[0].checked=!0)}}updateIndividualSelectOptions(){this.model.tdo.forEach((e,t)=>{this.model.cdo.forEach(a=>{if("select"==a.type&&void 0!==a.individual_select_options){let o=this.elements[t][a.db_field],i=this.model.getDbFieldArray(a.db_field);o.innerHTML="";let l=document.createElement("option");l.value="NULL",l.appendChild(document.createTextNode("Select...")),o.appendChild(l);let d=a.select_values,n=i.slice();n.splice(t,1);let r=[],s=[];d.forEach((e,t)=>{n.indexOf(e.value+"")<0&&(r.push(e.name),s.push(e.value))}),s.forEach((e,t)=>{(l=document.createElement("option")).value=s[t]+"",l.appendChild(document.createTextNode(r[t])),o.appendChild(l)}),o.value=e[a.db_field].data+""}})})}drawTable(){this.drawThead(),this.drawTotalsRow(),this.drawTbody(),this.drawFooter(),this.drawTableEditSaveButtons(),this.updateTableValues()}highlightRow(e){for(let t=0;t<this.rows.length;t++)t==e?this.rows[t].classList.add("row_selected"):this.rows[t].classList.remove("row_selected")}highlightHeaderRow(e,t){let a=this.header_elements;for(let o=0;o<a[e].length;o++)for(let i=0;i<a[e][o].length;i++)o==t?a[e][o][i].classList.add("header_selected"):a[e][o][i].classList.remove("header_selected")}createTableModifyDiv(){let e=document.createElement("div");return e.id=this.model.td.name+"_buttons",e.className="awesome-collection-table_buttons",e}createTableModifyButtons(){let e=document.createElement("div");e.className="awesome-collection-table_modify_buttons";let t,a=this,o=this.model.td.table_buttons;return o.includes("selectRows")&&((t=document.createElement("button")).innerHTML="Select All",t.id=name+"select_all",t.classList.add("button"),t.addEventListener("click",function(){a.selectAllClicked.notify()}),e.appendChild(t),(t=document.createElement("button")).innerHTML="Select None",t.id=name+"select_none",t.classList.add("button"),t.addEventListener("click",function(){a.selectNoneClicked.notify()}),e.appendChild(t)),o.includes("addRow")&&((t=document.createElement("button")).innerHTML="Add Row",t.id=name+"_add_row",t.classList.add("button"),t.addEventListener("click",function(){a.addRowClicked.notify()}),e.appendChild(t)),o.includes("copyRows")&&((t=document.createElement("button")).innerHTML="Copy Row(s)",t.id=name+"copy_row",t.classList.add("button"),t.addEventListener("click",function(){a.copyRowClicked.notify()}),e.appendChild(t)),o.includes("moveRows")&&((t=document.createElement("button")).innerHTML="Move Row(s) Up",t.id=name+"move_row_up",t.classList.add("button"),t.addEventListener("click",function(){a.moveRowUpClicked.notify()}),e.appendChild(t),(t=document.createElement("button")).innerHTML="Move Row(s) Down",t.id=name+"move_row_down",t.classList.add("button"),t.addEventListener("click",function(){a.moveRowDownClicked.notify()}),e.appendChild(t)),o.includes("deleteRow")&&((t=document.createElement("button")).innerHTML="Delete Row(s)",t.id=name+"_delete_row",t.classList.add("button"),t.addEventListener("click",function(){a.deleteRowClicked.notify()}),e.appendChild(t)),o.includes("deleteAllRows")&&((t=document.createElement("button")).innerHTML="Delete All Rows",t.id=name+"delete_all_rows",t.classList.add("button"),t.addEventListener("click",function(){a.deleteAllClicked.notify()}),e.appendChild(t)),o.includes("addColumn")&&((t=document.createElement("button")).innerHTML="Add Column",t.id=name+"add_column",t.classList.add("button"),t.addEventListener("click",function(){a.addColumnClicked.notify()}),e.appendChild(t)),o.includes("deleteColumn")&&((t=document.createElement("button")).innerHTML="Delete Column",t.id=name+"delete_column",t.classList.add("button"),t.addEventListener("click",function(){a.deleteColumnClicked.notify()}),e.appendChild(t)),e}showRowModifyButtons(){this.table_modify_div.appendChild(this.createTableModifyButtons())}hideRowModifyButtons(){this.table_modify_div.innerHTML=""}createEditButtonDiv(){let e=document.createElement("div");return e.className="awesome-collection-table_edit_buttons",e}updateTableValues(){for(let e=0;e<this.tbody.childNodes.length;e++)this.updateRowValues(e);this.updateTotals()}updateRowValues(e){let t=this.tbody_cells[e];for(let a=0;a<t.length;a++){let o=t[a].col_def,i=this.model.tdo[e][o.db_field].data;if(Array.isArray(i)){for(let e=0;e<i.length;e++)this.writeCellValue(o,t[a].td,i[e]),a++;a--}else this.writeCellValue(o,t[a].td,i)}}updateTotals(){this.updateTotalsRow(),this.updateFooter()}isColArray(e){return!(void 0===e.caption||!Array.isArray(e.caption))}getRCValue(e,t){let a=0,o=!1,i=!1;return this.model.cdo.forEach(l=>{if(!1!==l.show_on_list)if(this.isRowCheckbox(l)&&this.checkRead());else if(this.isColArray(l))for(let d=0;d<l.caption[0].length;d++)a!=t||o?a++:(o=!0,i={data:this.model.tdo[e][l.db_field].data[d],col_def:l});else a!=t||o?a++:(o=!0,i={data:this.model.tdo[e][l.db_field].data,col_def:l})}),i}}class f extends c{constructor(e){super(e);let t=e.view,a=e.model;this.controller=e,this.view=t,this.model=a,e.loadPageEvent=new d(e),t.deleteColumnClicked=new d(t),t.addRowClicked=new d(t),t.deleteRowClicked=new d(t),t.moveRowUpClicked=new d(t),t.moveRowDownClicked=new d(t),t.copyRowClicked=new d(t),t.deleteAllClicked=new d(t),t.makeTableWriteable=new d(t),t.makeTableReadable=new d(t),t.inputChanged=new d(t),t.individualSelectChanged=new d(t),t.dataTableChanged=new d(t),t.onEditClick=new d(t),e.view.onEditClick.attach(function(){"function"==typeof a.td.onEditClick?a.td.onEditClick():e.makeEditable()}),t.onCancelClick=new d(t),e.view.onCancelClick.attach(function(){e.model.loadBackupData(),e.makeReadable(),t.hideRowModifyButtons()}),e.onSaveSuccess=new d(e),e.onSaveSuccess.attach(function(a,o){e.model.td.access="read",t.drawTable(),e.model.original_data=e.getPostData()});let o=e;t.onRowClick=new d(t),t.onRowClick.attach(function(t,a){e.selectRow(a.sectionRowIndex)}),t.onHeaderArrayClick=new d(t),t.onHeaderArrayClick.attach(function(t,a){let o=a.e.target.parentNode.sectionRowIndex,i=a.col_def.db_field;e.selectHeaderRow(i,o),"function"==typeof e.model.td.onHeaderArrayClick&&e.model.td.onHeaderArrayClick(a)}),t.onHeaderClick=new d(t),t.onHeaderClick.attach(function(t,a){console.log("collection table controller on sort"),e.sort.onSort(a),"function"==typeof e.model.td.onHeaderClick&&e.model.td.onHeaderClick(a)}),t.selectAllClicked=new d(t),e.view.selectAllClicked.attach(function(){e.selectAll()}),t.selectNoneClicked=new d(t),e.view.selectNoneClicked.attach(function(){e.selectNone()}),t.addColumnClicked=new d(t),e.view.addColumnClicked.attach(function(){e.model.addColumnToArray(e.view.array_col),e.view.drawTable()}),e.view.deleteColumnClicked.attach(function(){e.model.deleteColumnFromArray(e.view.array_col),e.view.drawTable()}),e.view.addRowClicked.attach(function(){return e.addNewRow()}),e.view.deleteRowClicked.attach(function(){confirm("Confirm Delete Row(s)")&&o.deleteRow(confirm)}),e.view.moveRowUpClicked.attach(function(){o.moveRowUp()}),e.view.moveRowDownClicked.attach(function(){o.moveRowDown()}),e.view.copyRowClicked.attach(function(){o.copyRow()}),e.view.deleteAllClicked.attach(function(e){confirm("Confirm Delete All Rows")&&o.deleteAllRows(e)}),e.view.inputChanged.attach(function(t,a){console.log("inputChanged Event...  copyTable then updateTotals ... then the cd event");let i=a.element.parentNode,l=i.cellIndex,d=i.parentNode.sectionRowIndex;o.copyTable(),e.active_row=d,"function"==typeof e.model.td.onChange&&e.model.td.onChange(a,d,l)}),e.view.individualSelectChanged.attach(function(){o.copyTable(),o.view.updateIndividualSelectOptions(),o.view.inputChanged.notify()})}}class p{constructor(e){this.controller=e}getStoredSortName(){return this.controller.model.td.name+"_sort"}onSort(e,t){let a=e[0],o=e[1],i=["none","asc","desc"],l=o.sort;l=++l%i.length,o.sort=l;let d=o.col_def.db_field,n=this;switch(a.shiftKey||this.controller.view.header_elements_array.forEach(e=>{o!=e&&n.removeSort(e.col_def.db_field)}),i[l]){case"none":this.removeSort(d);break;case"asc":this.addSort(d,"asc");break;case"desc":this.removeSort(d),this.addSort(d,"desc")}this.storeSort(),this.renderSort()}renderSort(){this.controller.model.sortData(),this.controller.view.updateHeaderSortView(),this.controller.view.drawTbody(),this.controller.updateTable()}addSort(e,t){this.removeSort(e);let a={};a[e]=t,this.controller.model.sort.push(a)}storeSort(){let e=this.getSort();localStorage[this.getStoredSortName()]=JSON.stringify(e)}getSortFromStorage(){return!!localStorage[this.getStoredSortName()]&&JSON.parse(localStorage[this.getStoredSortName()])}loadSortFromDefault(){this.controller.model.cdo.forEach(e=>{void 0!==e.sort&&this.addSort(e.db_field,e.sort)})}removeSort(e){this.controller.model.sort=this.controller.model.sort.filter(function(t){return Object.keys(t)[0]!==e})}removeAllSort(){this.controller.model.sort=[],this.deleteStoredSort(),this.renderSort()}getSort(){let e={};return this.controller.model.sort.forEach(t=>{let a=Object.keys(t);e[this.controller.model.td.name+"_"+a[0]+"_sort"]=t[a[0]]}),e}loadSortFromQuery(e){this.loadSortFromKvp(e)}loadSortFromStorage(){console.log(this.getSortFromStorage()),this.loadSortFromKvp(this.getSortFromStorage())}loadSortFromKvp(e){for(var t in e)if(e.hasOwnProperty(t)&&t.includes("_sort")){let a=t.replace("_sort","");a=a.substring(this.controller.model.td.name.length+1,t.length),this.addSort(a,e[t])}}resetStoredSort(){this.controller.model.sort=[]}deleteStoredSort(){delete localStorage[this.getStoredSortName()]}}class _ extends s{constructor(e,t){super(e),this.view=t,this.cdo=this.model.cdo,this.active_row=null,this.collectionTableEvents=new f(this),this.row_properties=[],this.sort=new p(this)}addNewRow(){this.copyTable();let e=this.model.addNewRow();return this.view.drawTbody(),this.updateTable(),e}deleteRow(e=!0){if(this.model.tdo.length>0){let e=this.findCheckedRows();e.length>0&&(this.copyTable(),this.model.deleteRows(e))}this.view.drawTable()}copyRow(){this.copyTable();let e=this.findCheckedRows();e.length>0&&this.model.copyRows(e),this.view.drawTable()}selectAll(){this.model.getColDef("row_checkbox")&&this.model.tdo.forEach((e,t)=>{this.model.tdo[t].row_checkbox.data=1}),this.view.drawTable()}selectNone(){this.model.getColDef("row_checkbox")&&this.model.tdo.forEach((e,t)=>{this.model.tdo[t].row_checkbox.data=0}),this.view.drawTable()}moveRowUp(){let e=this.findCheckedRows(),t=!0;for(let a=0;a<e.length;a++)e[a]-1<0&&(t=!1);if(t){this.copyTable();for(let t=0;t<e.length;t++)this.model.moveRow(e[t],e[t]-1)}this.view.drawTable()}moveRowDown(){let e=this.findCheckedRows(),t=!0;for(let a=0;a<e.length;a++)e[a]+1>this.model.tdo.length-1&&(t=!1);if(t){this.copyTable();for(let t=e.length-1;t>-1;t--){let a=parseInt(e[t])+parseInt(1);this.model.moveRow(e[t],a)}}this.view.drawTable()}deleteAllRows(){this.model.DeleteAllRows(),this.view.drawTable()}findCheckedRows(){let e=this.view.tbody,t=e.rows.length,a=new Array,o=0;for(let i=0;i<t;i++){let t=e.rows[i].cells[0].childNodes[0];null!=t&&1==t.checked&&(a[o]=i,o+=1)}return a}copyTable(){for(let e=0;e<this.view.tbody_cells.length;e++)this.copyRowToModel(e)}copyRowToModel(e){let t=this.view.tbody_cells[e];for(let a=0;a<t.length;a++){let o=t[a].col_def,i=this.model.tdo[e][o.db_field].data;if(Array.isArray(i)){for(let l=0;l<i.length;l++)this.copyElementValueToModel(t[a].td.childNodes[0],o,e,l),a++;a--}else{let i=t[a].td.childNodes[0];this.copyElementValueToModel(i,o,e)}}}selectRow(e){this.active_row=e,this.view.highlightRow(e);let t=this.model.tdo[e].__row__.header_row;for(var a in t)this.view.highlightHeaderRow(a,t[a]);"function"==typeof this.model.td.onRowClick&&this.model.td.onRowClick(e)}headerClick(e){}selectHeaderRow(e,t){null!==this.active_row&&(this.model.tdo[this.active_row].__row__.header_row[e]=t),this.view.highlightHeaderRow(e,t)}addDataRow(e){if(Array.isArray(e))return this.developerAlert("data is an array, just send in one row or use addDataArray"),!1;this.model.addDataRow(e);this.view.drawTbody(),this.updateTable()}addDataArray(e){if(!Array.isArray(e))return this.developerAlert("data is not an array.... use addDataRow for just one row"),!1;for(let t=0;t<e.length;t++)this.addDataRow(e[t])}updateTable(){this.model.calculate(),this.view.updateTableValues()}setFocusToFirstInputOfRow(e){let t=this.view.elements_array[e];for(let e=0;e<t.length;e++)if("text"==t[e].type||"number"==t[e].type){t[e].focus(),t[e].select();break}this.active_row=e}validateDynamicTableObject(){for(errors="",i=0;i<this.model.cdo.length;i++)if(void 0!==this.model.cdo[i].db_field&&void 0!==this.model.cdo[i].validate){var e=document.getElementsByName(this.model.cdo[i].db_field+"[]");for(el=0;el<e.length;el++)void 0!==this.model.cdo[i].validate.not_blank_or_zero_or_false_or_null?""!=e[el].value&&0!=round2(e[el].value,0)&&"false"!=e[el].value&&"NULL"!=e[el].value||(errors+="Bad Value For "+this.model.cdo[i].caption+" Row "+(el+1)+newline()):void 0!==this.model.cdo[i].validate.acceptable_values&&(acceptable_values=this.model.cdo[i].validate.acceptable_values[0],"number"==acceptable_value?isNaN(e[el].value)&&(errors+=this.model.cdo[i].db_field+" needs to be a value."+newline(),e[el].focus()):"text"==acceptable_values||acceptable_values)}return""==errors?(needToConfirm=!1,document.getElementById("submit")&&(document.getElementById("submit").disabled=!0),!0):(alert(errors),needToConfirm=!0,!1)}getTableArrayColumnNumberFromHTMLColumnNumber(e){let t=0,a=0;for(i=0;i<this.model.cdo.length;i++)if(!1===this.model.cdo[i].show_on_list&&(a+=1),t+=1,e==a)return t;return-1}setChecks(e,t){let a=this.view.tbody;a.rows[e].cells[0].childNodes[0].checked=!1,a.rows[t].cells[0].childNodes[0].checked=!0}}function w(e,t){let a=!1;for(let o=0;o<t.length;o++)t[o]==e&&(a=!0);return a}class b{constructor(e){this.firstBy=a(1),this.sort=[],this.rdo={},this.modelChanged=new d(this),this.newRow=new d(this);let t=this;this.modelChanged.attach(function(){t.updateTableObjectLineNumbers()})}getData(e,t,a){return Array.isArray(this.tdo[t][e].data)?this.tdo[t][e].data[a]:this.tdo[t][e].data}sumArray(e,t){if(Array.isArray(this.tdo[t][e].data)){let a=0;for(let o=0;o<this.tdo[t][e].data.length;o++)a+=l(this.tdo[t][e].data[o]);return a}alert("Developer Error\n You are asking for an array sum for non array")}sumColumn(e){let t=0;for(let a=0;a<this.tdo.length;a++)t+=l(this.tdo[a][e].data);return t}loadColumnDefinition(e){this.cdo=e}loadData(e){this.backup_data=e,this.tdo=[];for(let t=0;t<e.length;t++)this.addDataRow(e[t]);this.sortData(),this.saveBackupData(),this.modelChanged.notify()}saveBackupData(){this.backup_data=JSON.stringify(this.tdo)}loadBackupData(){this.tdo=JSON.parse(this.backup_data)}dynamicSort(e){let t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(a,o){return(a[e].data<o[e].data?-1:a[e].data>o[e].data?1:0)*t}}sortData(){let e=this.firstBy(function(e,t){return 0});this.sort.forEach(t=>{let a=Object.keys(t),o=a[0];e="asc"==t[a[0]]?e.thenBy(function(e){return e[o].data}):e.thenBy(function(e){return e[o].data},-1)}),this.tdo.sort(e)}addDataRow(e){let t=this.addNewRow();return this.cdo.forEach(a=>{this.addItem(a,e,t)}),this.modelChanged.notify(),t}addNewRow(){let e=this.rowCount();return this.tdo[e]={},this.tdo[e].__row__={},this.tdo[e].__row__.header_row={},this.cdo.forEach(t=>{let a="";if(void 0!==t.default_value&&(a=t.default_value),void 0!==t.caption&&Array.isArray(t.caption)){let o=[];this.tdo[e][t.db_field]={},t.caption[0].forEach((e,t)=>{o[t]=a}),this.tdo[e][t.db_field].data=o,this.tdo[e][t.db_field].cell={},this.tdo[e].__row__.header_row[t.db_field]=null}else this.tdo[e][t.db_field]={},this.tdo[e][t.db_field].data=a,this.tdo[e][t.db_field].cell={}}),this.modelChanged.notify(),this.newRow.notify(),e}addItem(e,t,a){let o="";o=void 0!==t[e.db_field]?t[e.db_field]:void 0!==e.default_value?e.default_value:"",void 0!==e.row_number?(o=this.tdo.length,console.log("setting row number to "+o)):(this.tdo[a][e.db_field]={},this.tdo[a][e.db_field].data=o,this.tdo[a][e.db_field].cell={})}updateTableObjectLineNumbers(){if(-1!=this.getCDOColumnNumberFromName("row_number"))for(let e=0;e<this.tdo.length;e++)this.tdo[e].row_number.data=e+1}getCDOColumnNumberFromName(e){let t=-1;return this.cdo.forEach((a,o)=>{void 0!==a.db_field&&a.db_field==e&&(t=o)}),t}getColDef(e){return this.cdo[this.getCDOColumnNumberFromName(e)]}rowCount(){return this.tdo.length}copyRows(e,t="bottom"){let a=0,o=[];this.tdo.forEach((t,i)=>{o[a]=JSON.parse(JSON.stringify(t)),a++,w(i,e)&&(o[a]=JSON.parse(JSON.stringify(t)),o[a].row_checkbox.data=0,a++)}),this.tdo=o,this.modelChanged.notify()}moveRow(e,t){let a=[];for(let o=0;o<this.tdo.length;o++)a[o]=e==o?this.tdo[t]:t==o?this.tdo[e]:this.tdo[o];this.tdo=a,this.modelChanged.notify()}deleteRows(e){this.modelChanged.notify();let t=0,a=[];for(let o=0;o<this.tdo.length;o++)w(o,e)||(a[t]=this.tdo[o],t++);this.tdo=a,this.modelChanged.notify()}DeleteAllRows(){this.tdo=[],this.modelChanged.notify()}getDbFieldArray(e){let t=[];return this.tdo.forEach(a=>{t.push(a[e].data+"")}),t}addColumnToArray(e){this.cdo[e].caption.forEach(e=>{e.push("")});let t=this.cdo[e].db_field;this.tdo.forEach(e=>{e[t].data.push(""),console.log(e[t].data)}),this.modelChanged.notify()}deleteColumnFromArray(e){this.cdo[e].caption.forEach(e=>{e.pop()});let t=this.cdo[e].db_field;this.tdo.forEach(e=>{e[t].data.pop()}),this.modelChanged.notify()}getFooterValue(e,t){let a=this.getCDOColumnNumberFromName(e);if("function"==typeof this.cdo[a].footer[t].getValue)return this.cdo[a].footer[t].getValue();console.log("Developer alert "+e+" footer .getValue needs to be a function")}calculate(){let e=this.td.row_calculations;if(void 0!==e)for(let t=0;t<this.tdo.length;t++)for(let a=0;a<e.length;a++)e[a](t)}}class v extends m{constructor(e){super(e)}createSearchTable(){let e=this.model.td.name;return this.searchDiv=this.createSearchDiv(),this.searchTableElement=this.createSearchTableElement(e),this.searchDiv.appendChild(this.searchTableElement),this.searchThead=this.createSearchThead(e),this.searchTableElement.appendChild(this.searchThead),this.searchTbody=this.createSearchTbody(e),this.searchTableElement.appendChild(this.searchTbody),this.updateSearchTable(),this.searchDiv.appendChild(this.createSearchButtons()),this.searchDataTableDiv=this.createDataTableDiv(),this.searchDiv.appendChild(this.searchDataTableDiv),this.searchDiv}createSearchButtons(){let e=this;return this.searchButtonDiv=document.createElement("div"),this.searchButtonDiv.className="search_buttons",this.searchButton=document.createElement("button"),this.searchButton.className="search",this.searchButton.id="search_"+this.model.td.name,this.searchButton.onclick=function(){e.searchClicked.notify()},this.searchButton.innerHTML='<i class="fa fa-binoculars" aria-hidden="true"></i><p>Search</p>',this.searchButtonDiv.appendChild(this.searchButton),this.searchResetButton=document.createElement("button"),this.searchResetButton.onclick=function(){e.resetClicked.notify()},this.searchResetButton.innerHTML="<p>Reset</p>",this.searchResetButton.className="reset",this.searchResetButton.id="reset_"+this.model.td.name,this.searchButtonDiv.appendChild(this.searchResetButton),this.searchButtonDiv}updateSearchTable(){this.updateSearchThead(this.searchThead),this.updateSearchTbody(this.searchTbody)}createSearchDiv(){let e=document.createElement("div"),t=this;return e.addEventListener("keyup",function(e){13==e.which&&(console.log("enter pressed"),t.searchClicked.notify())}),e}createSearchTableElement(e){let t=document.createElement("table");return t.id=e+"_search",t.classList.add("awesome-search-table"),t.classList.add("table"),t}createSearchThead(e){let t=document.createElement("thead");return t.id=e+"_search_thead",t}createSearchTbody(e){let t=document.createElement("tbody");return t.id=e+"_search_tbody",t}createDataTableDiv(){return document.createElement("div")}updateSearchThead(e){let t=e.insertRow();this.model.cdo.forEach(e=>{if(void 0!==e.search){let a="";void 0!==e.th_width&&(a=e.th_width);let o="";if(void 0!==e.caption&&(o=e.caption),"date"==e.type){let e=document.createElement("th");e.innerHTML=o+" Start Date",e.style.width=a,t.appendChild(e);let i=document.createElement("th");e.style.width=a,i.innerHTML=o+" END Date",t.appendChild(i)}else{let e=document.createElement("th");e.innerHTML=o,e.style.width=a,t.appendChild(e)}}})}updateSearchTbody(e){let t=e.insertRow(),a=0;this.search_elements_array=[],this.search_elements_by_name={},this.model.cdo.forEach(e=>{if(void 0!==e.search){let o=t.insertCell(a);if(o.id="sr0sc"+a,a++,"date"==e.type){let i=document.createElement("input");i.type="date",i.name=this.model.td.name+"_"+e.db_field+"_date_start",o.appendChild(i),this.search_elements_array.push(i),this.search_elements_by_name[e.db_field+"_date_start"]=i,e.search_element=[],e.search_element[0]=i,(o=t.insertCell(a)).id="sr0sc"+a,a++;let l=document.createElement("input");l.type="date",l.name=this.model.td.name+"_"+e.db_field+"_date_end",o.appendChild(l),this.search_elements_array.push(l),this.search_elements_by_name[e.db_field+"_date_end"]=l,e.search_element[1]=l}else if("checkbox"==e.type){let t=document.createElement("select");t.name=this.model.td.name+"_"+e.db_field;let a=document.createElement("option");a.value="null",a.appendChild(document.createTextNode("Either")),t.appendChild(a),(a=document.createElement("option")).value="1",a.appendChild(document.createTextNode("Checked")),t.appendChild(a),(a=document.createElement("option")).value="0",a.appendChild(document.createTextNode("Not Checked")),t.appendChild(a),o.appendChild(t),this.search_elements_array.push(t),this.search_elements_by_name[e.db_field]=t,e.search_element=t}else if("select"==e.type){let t=this.createSelect(e);t.name=this.model.td.name+"_"+e.db_field,o.appendChild(t),this.search_elements_array.push(t),e.search_element=t,this.search_elements_by_name[e.db_field]=t}else if("tree_select"==e.type){let t=this.createTreeSelect(e);t.name=this.model.td.name+"_"+e.db_field,o.appendChild(t),this.search_elements_array.push(t),this.search_elements_by_name[e.db_field]=t,e.search_element=t}else{let t=document.createElement("input");t.type=e.type,t.name=this.model.td.name+"_"+e.db_field,o.appendChild(t),this.search_elements_array.push(t),this.search_elements_by_name[e.db_field]=t,e.search_element=t}}})}addMessageInsteadOfTable(e){let t=document.createElement("div");t.innerHTML=e,this.searchDataTableDiv.innerHTML="",this.searchDataTableDiv.appendChild(t)}addDataTable(){this.searchDataTableDiv.innerHTML="",this.searchDataTableDiv.appendChild(this.createCollectionTable())}destroyCollectionTable(){this.searchDataTableDiv.innerHTML=""}searching(){this.addMessageInsteadOfTable("searching...")}}class y{constructor(e){e.searchReturned=new d(e),e.searching=new d(e),e.view.searchClicked=new d(e.view),e.view.resetClicked=new d(e.view),e.view.searchClicked.attach(function(){e.onSearchClicked()}),e.searching.attach(function(){}),e.searchReturned.attach(function(t,a){e.onSearchReturned(a)}),e.loadPageEvent=new d(e),e.view.resetClicked.attach(function(){e.onResetClicked()})}}class C extends _{constructor(e,t){super(e,t),this.show_records_autmatically_below=50,this.searchTableEvents=new y(this)}getSearchFormData(){let e={};return this.view.search_elements_array.forEach(t=>{e[t.name]=t.value}),e.table_name=this.model.td.name,e}getSearchPostData(){let e={search_fields:{}};return e.table_name=this.model.td.name,this.view.search_elements_array.forEach(t=>{e.search_fields[t.name]=t.value}),console.log("I need controller for testing.... search post data"),console.log(JSON.stringify(e)),e}onSearchReturned(e){let t=e.data;this.number_of_records_available=t.length,this.model.loadData(t),this.loadInitialData()}loadInitialData(){this.number_of_records_available>0&&0==this.model.tdo.length?this.number_of_records_available<this.show_records_autmatically_below?this.view.searchClicked.notify():this.view.addMessageInsteadOfTable(`There are ${this.number_of_records_available} records available... please search to see the data. To sort data returned click on the column header. You may also use shift+click for multiple column sorting.`):0==this.number_of_records_available&&0==this.model.tdo.length?this.view.addMessageInsteadOfTable("There are 0 records available."):(this.view.addDataTable(),this.setFocusToFirstInputOfSearch())}populateSearchValuesFromDefaultValues(){console.log("SearchTableController: populating search values from default"),this.model.cdo.forEach(e=>{void 0!==e.search&&void 0!==e.search_default&&("date"==e.type?(void 0!==e.search_default.start&&(e.search_element[0].value=e.search_default.start),void 0!==e.search_default.end&&(e.search_element[1].value=e.search_default.end)):e.search_element.value=e.search_default)})}renderSearch(e){this.model.loadData(e),e.length>0?(this.view.addDataTable(),this.setFocusToFirstInputOfSearch()):(this.view.addMessageInsteadOfTable("There are no search results"),this.setFocusToFirstInputOfSearch()),"function"==typeof this.model.td.onLoadPageComplete&&this.model.td.onLoadPageComplete()}onSearchClicked(){this.storeSearch();this.getSearchFormData();let e=this.getQueryString();"function"==typeof this.model.td.onSearchClick&&this.model.td.onSearchClick(e)}getAndRenderSearch(){let e=this,t=e.model.td.getData(e.getSearchPostData());!1!==t&&e.renderSearch(t)}onResetClicked(){this.view.search_elements_array.forEach(e=>{switch(e.type){case"tree_select":case"select-multiple":case"select-one":e.value="null";break;default:e.value=""}}),this.setFocusToFirstInputOfSearch(),this.view.addMessageInsteadOfTable("Press search to display results"),this.clearStoredSearch(),this.sort.deleteStoredSort(),this.sort.resetStoredSort(),"function"==typeof this.model.td.onResetClick&&this.model.td.onResetClick()}getSearchFormValues(){let e={};return this.view.search_elements_array.forEach(t=>{switch(t.type){case"text":case"number":case"date":name=t.name,e[name]=t.value,t.value;break;case"tree_select":case"select-multiple":case"select-one":name=t.name,e[name]=t.value,t.value}}),e}setFocusToFirstInputOfSearch(){"input"===this.view.search_elements_array[0].nodeName.toLowerCase()?(this.view.search_elements_array[0].focus(),this.view.search_elements_array[0].select()):"select"===this.view.search_elements_array[0].nodeName.toLowerCase()?(console.log("select......."),this.view.search_elements_array[0].focus()):(this.view.search_elements_array[0].focus(),this.view.search_elements_array[0].select())}getStoredSearchName(){return this.model.td.name+"_search"}getQueryValues(){let e=this.sort.getSort(),t=this.getSearchFormData();return Object.assign(t,e)}getQueryString(){let e=this.getQueryValues();return Object.keys(e).map(function(t){return t+"="+e[t]}).join("&")}checkQuery(e){for(let t=0;t<this.view.search_elements_array.length;t++)if(e[this.view.search_elements_array[t].name])return!0;return!1}loadFromUri(e){console.log("loading from uri"),this.loadSearchValues(e),this.storeSearch()}loadSearchValues(e){this.view.search_elements_array.forEach(t=>{e[t.name]&&(t.value=e[t.name])})}checkSearchStorage(){return!!localStorage[this.getStoredSearchName()]&&localStorage[this.getStoredSearchName()]}clearStoredSearch(){delete localStorage[this.getStoredSearchName()]}retrieveSearch(){return JSON.parse(localStorage[this.getStoredSearchName()])}storeSearch(){let e=this.getSearchFormValues();localStorage[this.getStoredSearchName()]=JSON.stringify(e)}loadSearchFromStorage(){console.log("loading search values from storage");let e=this.retrieveSearch();return this.view.search_elements_array.forEach(t=>{e[t.name]&&(t.value=e[t.name])}),e}}class T{constructor(e){this.awesomeTable=e}cd(){return{db_field:"replace",caption:"replace",type:"id html date time password text number textarea row_checkbox row_number checkbox select tree_select button link radio",min:1,max:"2018-01-12",readonly:!0,select_values:this.select_values(),individual_select_options:!0,button_caption:"only for a button",default_value:"default value is set",show_on_list:!0,show_on_view:!0,show_on_create:!0,show_on_edit:!0,th_width:10,search:"LIKE ANY BETWEEN EXACT",search_default:"",total:0,round:0,events:[],properties:[],word_wrap:!0,post:!0}}allOptions(){var e=[];return e.push(this.row_checkbox()),e.push(this.row_number()),e.push(this.select()),e.push(this.tree_select()),e.push(this.individual_select()),e.push(this.button()),e.push(this.link()),e.push(this.checkbox()),e.push(this.radio()),e.push(this.input()),e.push(this.date()),e.push(this.time()),e.push(this.datetime()),(e=e.concat(this.password())).push(this.textarea()),e=e.concat(this.numbers())}purchaseOrder(e,t){var a=[];return a.push(this.row_checkbox()),a.push(this.row_number()),a.push(this.style()),(a=a.concat(this.sizes(e))).push(this.cost(t)),a.push(this.total()),a}select_values(){return[{value:1,name:"liliana"},{value:2,name:"two"},{value:3,name:"three"},{value:4,name:"four"},{value:5,name:"five"},{value:6,name:"six"},{value:7,name:"seven"},{value:8,name:"eight"},{value:9,name:"nine"}]}style(){return{db_field:"style",type:"text",default_value:"default value",caption:"Style",width:"100px"}}cost(e){let t=this,a=function(a,o){let i=t.awesomeTable.getRow(a.srcElement);console.log(o),e(i)};return{db_field:"cost",type:"number",caption:"Cost",width:"100px",events:{change:a,keyup:a,click:a}}}total(){let e=this,t=function(){return e.awesomeTable.model.sumColumn("total")},a=function(){return.08*t()};return{db_field:"total",type:"text",properties:[{readOnly:!0}],caption:"Total",width:"100px",footer:[{caption:"Subtotal",round:2,getValue:function(){return t()}},{caption:"Tax",round:2,getValue:function(){return a()}},{caption:"Total",round:2,getValue:function(){return t()+a()}}],total:2,round:2}}sizes(e){let t=function(t,a){e(a.r)},a=this;return[{db_field:"sizes",caption:[["XS","S","M","L",""],["40","42","44","46",""],["1","2","3","4","5"]],min:0,type:"number",default_value:"",show_on_list:!0,show_on_view:!0,show_on_edit:!0,show_on_create:!0,width:"50px",class:"",events:{keyup:t,click:t,change:t},properties:[],word_wrap:!0},{db_field:"qty",caption:"Quantity",type:"text",default_value:"",footer:[{caption:"Total Quantity",round:0,getValue:function(){return a.awesomeTable.model.sumColumn("qty")}}],width:"100px",td_tags:"",class:"",events:[],search:"LIKE ANY BETWEEN EXACT",properties:[{readOnly:!0}],total:0,round:0,word_wrap:!0}]}select_values(){return[{value:1,name:"liliana"},{value:2,name:"two"},{value:3,name:"three"},{value:4,name:"four"},{value:5,name:"five"},{value:6,name:"six"},{value:7,name:"seven"},{value:8,name:"eight"},{value:9,name:"nine"}]}tree_select_values(){return[{name:"one",value:"1",children:[{name:"one_child_one",value:"1_1"},{name:"one_child_two",value:"1_2"}]},{name:"two",value:"2",children:[{name:"two_child_one",value:"2_1",children:[{name:"two_child_one_child_one",value:"2_1_1"},{name:"two_child_two_child_two",value:"2_1_2"}]},{name:"two_child_two",value:"2_2"}]}]}button(){return{db_field:"button",type:"button",button_caption:"button",th_width:100,caption:"Button"}}link(){return{db_field:"link",type:"link",caption:"Link",default_value:"link",editable:!1,search:!0,search_default:""}}checkbox(){return{db_field:"checkbox",type:"checkbox",caption:"Checkbox",default_value:1,search:!0,search_default:""}}radio(){return{db_field:"radio",type:"radio",caption:"Radio"}}input(){return{db_field:"input",type:"text",caption:"Text Input",placeholder:"",search:!0,search_default:""}}date(){return{db_field:"date",type:"date",caption:"Date",placeholder:"YYYY-MM-DD",search:!0,search_default:""}}time(){return{db_field:"time",type:"text",caption:"Time",placeholder:"HH:MM:SS 24 hour or 12 hour with PM",search:!0,search_default:""}}datetime(){return{db_field:"date_time",type:"text",caption:"Date Time",placeholder:"YYYY-MM-DD HH:MM",search:!0,search_default:""}}password(){return[{db_field:"password",type:"password",caption:"Password",show_on_edit:!1,show_on_list:!1,show_on_view:!1,show_on_create:!0},{db_field:"password_confirmation",type:"password",caption:"Password Confirmation",show_on_edit:!1,show_on_list:!1,show_on_view:!1,show_on_create:!0}]}textarea(){return{db_field:"textarea",type:"textarea",caption:"Textarea",search:!0,search_default:""}}numbers(){return[{db_field:"number",type:"number",caption:"Number",search:!0,search_default:""},{db_field:"number_round_2",type:"number",caption:"Number Rounded 2 Places",default_value:10,round:2,total:2,search:!0,search_default:""},{db_field:"number_round_0",type:"number",caption:"Number Rounded 0 Places",default_value:20,round:0,total:0,search:!0,search_default:""}]}row_number(){return{type:"row_number",db_field:"row_number",caption:"Row",width:"100px"}}row_checkbox(){return{type:"row_checkbox",db_field:"row_checkbox",width:"100px"}}select(){return{db_field:"select",type:"select",select_values:this.select_values(),caption:"select",default_value:!1,search:!0,search_default:""}}tree_select(){return{db_field:"tree_select",type:"tree_select",select_values:this.tree_select_values(),caption:"Tree Select",default_value:1,search:!0,search_default:""}}individual_select(){return{db_field:"individual_select",type:"select",select_values:this.select_values(),individual_select_options:!0,caption:"Individual Select",search:!0,search_default:""}}}class g{verifyTableDefinition(e){let t=!0,a=[];void 0===e.name&&(t=!1,a.push("name is not defined"))}td(){return{name:"name",access:"READ WRITE",buttons:["selectRows","addRow","deleteRow","deleteAllRows","moveRows","copyRows","addColumn","deleteColumn","edit"],table_view:"index show create edit",route:"vendors  routes: vendor post is search, vendor put vendor patch vendor delete ",footer:[],header:[],column_definition:this.cd(),getData:function(){let e=[];return e[0]={},e[0].name="name",e},onChange:function(e,t,a){},onSaveClick(){alert("save")},onSaveSuccess(){alert("saved")},onDeleteClick(){alert("delete")},onDeleteSuccess(){alert("deleted")},onCreateSaved(e){alert("deleted")},onCancelClick(){alert("canceled")},onCancelCreateClick(){alert("canceled")},onHeaderArrayClick(e){},onSearchClick(){}}}}a.d(t,"AwesomeTable",function(){return k});class k{constructor(e,t){switch(this.ColumnDefinition=new T(this),this.TableDefinition=new g(this),this.type=e,e){case"record":this.model=new b(t),this.view=new r(this.model),this.controller=new u(this.model,this.view);break;case"collection":this.model=new b,this.view=new m(this.model),this.controller=new _(this.model,this.view);break;case"searchable":this.model=new b,this.view=new v(this.model),this.controller=new C(this.model,this.view);break;default:console.log("missed the type in the table definition")}}columnDefinition(){}loadConfiguration(e){switch(this.model.td=e,this.model.loadColumnDefinition(e.column_definition),"undefined"!==e.data&&("record"==this.type?this.model.loadData([e.data]):this.model.loadData(e.data)),this.type){case"record":void 0===e.table_view&&(this.model.td.table_view="show");break;case"collection":case"searchable":this.model.td.table_view="index";break;default:console.log("missed the type in the table definition")}return this}addTo(e){this.div=document.getElementById(e),this.div.appendChild(this.getTable()),this.type}renderSearchResults(e){this.controller.renderSearch(e)}getTable(){switch(this.type){case"record":return this.view.createRecordTable();case"collection":return this.view.createCollectionTable();case"searchable":return this.view.createSearchTable();default:console.log("missed the type in the table definition")}}clone(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var a=0,o=e.length;a<o;a++)t[a]=this.clone(e[a]);return t}if(e instanceof Object){for(var i in t={},e)e.hasOwnProperty(i)&&(t[i]=this.clone(e[i]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}setValue(e,t,a){this.controller.updateCellValue(e,t,a)}reCalculateTable(e){}getCellByName(e,t,a="undefined"){return"undefined"!==a?this.view.cells_by_name[t][e][a]:this.view.cells_by_name[t][e]}getRow(e){return this.controller.findElement(e)[0]}addDataRow(e){this.controller.addDataRow(e)}addDataArray(e){this.controller.addDataArray(e)}sumArray(e,t){return this.model.sumArray(e,t)}developerAlert(e){console.log("Developer Alert! \n"+e)}checkRowNumber(e){return void 0!==this.model.tdo[e]||(this.developerAlert("the row number "+e+" is undefined, fix your call...."),!1)}checkColumnName(e){if(void 0!==this.model.tdo[0][e])return!0;this.developerAlert("the column name "+e+" is undefined, fix your call....")}getValue(e,t,a){if(this.checkRowNumber(t)&&this.checkColumnName(e))return void 0!==a?this.model.tdo[t][e].data[a]:this.model.tdo[t][e].data}getSelectName(e,t){return this.controller.getSelectValueName(e,t)}removeResultsTable(){this.searchController.view.destroyCollectionTable()}}},function(e,t){e.exports=function(){function e(e){return e}function t(e){return"string"==typeof e?e.toLowerCase():e}return function a(o,i){var l="function"==typeof this&&this,d=function(a,o){if(o="number"==typeof o?{direction:o}:o||{},"function"!=typeof a){var i=a;a=function(e){return e[i]?e[i]:""}}if(1===a.length){var l=a,d=o.ignoreCase?t:e;a=function(e,t){return d(l(e))<d(l(t))?-1:d(l(e))>d(l(t))?1:0}}return-1===o.direction?function(e,t){return-a(e,t)}:a}(o,i),n=l?function(e,t){return l(e,t)||d(e,t)}:d;return n.thenBy=a,n}}()}])});