!function(e){var t={};function o(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=t,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},o.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";function a(e,t){if(""==function(e){for(e=(e+="").replace("\t","");" "==e.substring(0,1);)e=e.substring(1,e.length);for(;" "==e.substring(e.length-1,e.length);)e=e.substring(0,e.length-1);return e}(e)&&(e=0),isNaN(e))return e;{let o=parseFloat(e);return(o=Math.round(e*Math.pow(10,t))/Math.pow(10,t)).toFixed(t)}}function l(e){return""==e||"0"==e||"null"==e||null==e?0:parseFloat(e)}o.r(t);class n{constructor(e){this._sender=e,this._listeners=[]}attach(e){this._listeners.push(e)}notify(e){for(let t=0;t<this._listeners.length;t+=1)this._listeners[t](this._sender,e)}}class d{constructor(e){this.id=e,this.error_body_id=this.id+"_body"}createErrorModal(){this.id;let e=document.createElement("div"),t=`\n<div id="${this.id}" class="modal fade" tabindex="-1" role="dialog"  data-backdrop="static">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      \n      <div id="${this.error_body_id}" class="modal-body">\n         \n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-primary btn-lg" id="${this.id}_confirmTrue" >OK</button>\n      </div>\n    </div>\x3c!-- /.modal-content --\x3e\n  </div>\x3c!-- /.modal-dialog --\x3e\n</div>\x3c!-- /.modal --\x3e\n`;e.innerHTML=t;let o=e.children[0];$(o).keypress(function(e){13==e.which&&$(o).modal("hide")});let a=this;return $(document).on("click","#"+this.id+"_confirmTrue",function(e){a.hide()}),this.error_div=o,o}addErrorMessage(e){let t=document.createElement("div"),o=document.createElement("h2");o.innerHTML="There was a problem:",t.appendChild(o);let a,i,l=document.createElement("ul");l.className="errorList";for(let t in e)(i=e[t]).forEach(e=>{(a=document.createElement("li")).innerHTML=e,l.appendChild(a)});t.appendChild(l),$("#"+this.error_body_id).html(t)}show(){console.log("showing error modal"),$(this.error_div).modal("show")}hide(){$(this.error_div).modal("hide")}onClick(){console.log("user clicked modal dismiss")}}class s{constructor(e){this.id=e;let t=document.createElement("div");t.className="modal fade",t.setAttribute("tabindex",-1),t.setAttribute("id",this.id),t.setAttribute("role","dialog"),t.setAttribute("data-backdrop","static"),this.modal_div=t;let o=document.createElement("div");t.appendChild(o),o.className="modal-dialog",o.setAttribute("id",this.id+"_dialog"),o.setAttribute("role","document");let a=document.createElement("div");o.appendChild(a),a.className="modal-content";let i=document.createElement("div");a.appendChild(i),i.className="modal-body",i.setAttribute("id",this.id+"_body"),this.modal_body_div=i;let l=document.createElement("div");a.appendChild(l),l.className="modal-footer record_table_buttons",l.setAttribute("id",this.id+"_footer"),this.modal_footer_div=l}setBody(e){this.modal_body_div.appendChild(e)}get(){return this.modal_div}create(e){this.id;let t=document.createElement("div"),o=`\n<div id="${this.id}" class="modal fade" tabindex="-1" role="dialog"  data-backdrop="static">\n  <div id="${this.id}_dialog"class="modal-dialog" role="document">\n    <div class="modal-content">\n      \n      <div id="${this.id+"_body"}" class="modal-body">\n      </div> \n      \n      <div id="${this.id}_footer"class="modal-footer">\n        \n      </div>\n     \n    </div>\x3c!-- /.modal-content --\x3e\n  </div>\x3c!-- /.modal-dialog --\x3e\n</div>\x3c!-- /.modal --\x3e\n`;t.innerHTML=o;let a=t.children[0];return $(a).find("#"+this.id+"_body").html(e),$(a).keypress(function(e){e.which}),this.modal_div=a,a}show(){$(this.modal_div).modal("show")}hide(){$(this.modal_div).modal("hide")}setFooter(e){this.modal_footer_div.appendChild(e)}}class r{constructor(e){this.model=e,this.cdo=e.td.column_definition,this.id=this.model.td.name,this.errorModal=new d(this.model.td.name+"_error_modal"),this.formModal=new s(this.model.td.name+"_form_modal"),this.waitModal=function(){let e=document.createElement("div");return e.innerHTML='\n<div class="modal" id="wait_modal" tabindex="-1" role="dialog"  data-keyboard="false" data-backdrop="static">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-body">\n                <div class="modalWaitContents">\n                    <div class="modalWaitIconDiv">               \n                        <i class="fa fa-circle-o-notch fa-spin"></i>\n                    </div>\n                    <div class="modalWaitText">\n                        <h2>Please wait...</h2>\n                        <p>I am communicating with the server...</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n',e.children[0]}(),this.confirmModal=function(){let e=document.createElement("div");return e.innerHTML='\n<div class="confirmModalDiv modal fade" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static">\n  <div class="modal-dialog" role="document">\n    <div class="confirmModalContent modal-content">\n      <div class="confirmModalHeader modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  \n      </div>\n      <div class="confirmModalBody modal-body">\n         <h3 id="confirmMessage"></h3>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default btn-danger-light btn-lg" data-dismiss="modal" id="confirmFalse">Cancel</button>\n        <button type="button" class="btn btn-primary btn-lg" id="confirmTrue">Confirm</button>\n      </div>\n    </div>\x3c!-- /.modal-content --\x3e\n  </div>\x3c!-- /.modal-dialog --\x3e\n</div>\x3c!-- /.modal --\x3e\n',e.children[0]}(),this.name=this.id}checkWrite(){let e=!1;return"WRITE"==this.model.td.access.toUpperCase()&&(e=!0),e}checkRead(){return!this.checkWrite()}createModalTable(e){"modal"==this.model.options.edit_display||this.model.options.edit_display,this.formModal.setBody(e);let t=document.createElement("div");return t.appendChild(this.createSaveButton()),t.appendChild(this.createCancelButton()),this.formModal.setFooter(t),this.formModal.get()}showModalTable(){this.formModal.show()}hideModalTable(){this.formModal.hide()}updateButtons(){this.edit_button_div.innerHTML="",this.checkRead()?(this.model.td.table_buttons.includes("edit")&&this.edit_button_div.appendChild(this.createEditButton()),this.model.td.table_buttons.includes("delete")&&this.edit_button_div.appendChild(this.createDeleteButton())):"on_page"==this.model.options.edit_display?(this.edit_button_div.appendChild(this.createSaveButton()),this.edit_button_div.appendChild(this.createCancelButton())):"modal"==this.model.options.edit_display||this.model.options.edit_display}createElement(e,t,o){t.db_field;switch(t.type.toLowerCase()){case"date":return this.createDateInput(t,e);case"text":return this.createTextInput(t,e);case"password":return this.createPasswordInput(t,e);case"textarea":return this.createTextArea(t,e);case"number":return this.createNumberInput(t,e);case"checkbox":return this.createCheckBox(t,e);case"row_checkbox":return this.createRowCheckbox(t,e);case"row_number":return this.createRowNumber(t,e);case"select":return this.createDataTableSelect(t,e);case"tree_select":return this.createDataTableTreeSelect(t,e);case"html":return this.createTextNode(t,e);case"radio":return this.createRadio(t,e);case"button":return this.createButton(t,e);case"link":return this.createLink(t,e);default:return document.createTextNode("no type coded for "+t.type+" type should be set to html date text number checkbox select tree_select button link textarea")}}createTextArea(e,t){if(this.checkWrite()){let o=document.createElement("TEXTAREA"),a=this;return o.addEventListener("keyup",function(){a.inputChanged.notify()}),this.addEvents(e,o),this.addProperties(e,o),o.value=t,o}return t?document.createTextNode(t):document.createTextNode("")}createCheckBox(e,t){let o=document.createElement("input");o.type="checkbox";let a=this;return o.addEventListener("click",function(){a.inputChanged.notify()}),this.addEvents(e,o),1!=t&&"1"!=t&&1!=t&&"true"!=t||(o.checked=!0),this.checkWrite()?this.addProperties(e,o):o.disabled=!0,o}createRowCheckbox(e,t){if(this.checkWrite()){let o=document.createElement("input");o.type="checkbox",t&&(o.checked=!0);let a=this;return o.addEventListener("onclick",function(){a.inputChanged.notify()}),this.addEvents(e,o),this.addProperties(e,o),o.value=t,o}}createRowNumber(e,t){return document.createTextNode(t)}createNumberInput(e,t){if(this.checkWrite()){let o=document.createElement("input");o.type="number",o.pattern="[0-9. -]*";let i=this;return o.addEventListener("keyup",function(){i.inputChanged.notify()}),o.addEventListener("click",function(){i.inputChanged.notify()}),o.addEventListener("change",function(){i.inputChanged.notify()}),this.addEvents(e,o),this.addProperties(e,o),void 0!==e.round&&(t=a(t=l(t),e.round)),o.value=t,o}return void 0!==e.round&&(t=a(t=l(t),e.round)),document.createTextNode(t)}createTextInput(e,t){if(this.checkWrite()){let o=document.createElement("input");o.type="text",void 0!==e.placeholder&&e.placeholder&&(o.placeholder=e.placeholder);let a=this;return o.addEventListener("keyup",function(){a.inputChanged.notify()}),this.addEvents(e,o),this.addProperties(e,o),o.value=t,o}return t?document.createTextNode(t):document.createTextNode("")}createPasswordInput(e,t){if(this.checkWrite()){let o=document.createElement("input");o.type="password",o.name=e.db_field+"[]";let a=this;return o.addEventListener("keyup",function(){a.inputChanged.notify()}),this.addEvents(e,o),this.addProperties(e,o),o.value=t,o}return document.createTextNode(t)}createDateInput(e,t){if(this.checkWrite()){let o=document.createElement("input");o.type="date",o.value=t;let a=this;return o.addEventListener("onchange",function(){a.inputChanged.notify()}),this.addEvents(e,o),o.onchange=function(){a.inputChanged.notify()},o}return document.createTextNode(t)}createLink(e,t){if("index"==this.model.td.table_view){let o=document.createElement("a"),a=document.createTextNode(t);return o.appendChild(a),"function"==typeof e.onClick&&o.addEventListener("click",function(){e.onClick(t)}),o}return this.createTextNode(e,t)}createButton(e,t){let o=document.createElement("button");if(o.className="button",void 0!==e.button_caption){let t=document.createTextNode(e.button_caption);o.appendChild(t)}return this.addEvents(e,o),this.addProperties(e,o),o}createTextNode(e,t){var o;return void 0!==e.round&&(o=t,!isNaN(parseFloat(o))&&isFinite(o)&&(t=a(t=l(t),e.round))),document.createTextNode(t)}createRadio(e,t){let o=document.createElement("input");o.type="radio",o.name=e.db_field+"[]";let a=this;return o.addEventListener("onclick",function(){a.inputChanged.notify()}),this.addEvents(e,o),1==t&&(o.checked=!0),this.checkWrite()?this.addProperties(e,o):o.disabled=!0,o}addEvents(e,t){void 0!==e.events&&e.events.forEach(e=>{for(let o in e){t.addEventListener(o,e[o])}})}addProperties(e,t){void 0!==e.properties&&e.properties.forEach(e=>{for(let o in e)t[o]=e[o]})}createDataTableSelect(e,t){if(this.checkWrite()){let o=this.createSelect(e),a=this;return void 0!==e.individual_select_options?o.onchange=function(){a.individualSelectChanged.notify()}:o.onchange=function(){a.inputChanged.notify()},this.addProperties(e,o),this.addEvents(e,o),o.value=t+"",o}{let o="";return e.select_values.forEach(e=>{e.value==t&&(o=e.name)}),document.createTextNode(o)}}createSelect(e){let t=document.createElement("select"),o=document.createElement("option");return o.value="null",o.appendChild(document.createTextNode("Select...")),t.appendChild(o),e.select_values.forEach(e=>{(o=document.createElement("option")).value=e.value+"",o.appendChild(document.createTextNode(e.name+"")),t.appendChild(o)}),t}findTreeSelectValue(e,t){for(let o=0;o<e.length;o++){if(t==e[o].value)return e[o].name;let a=!1;if(void 0!==e[o].children&&(a=this.findTreeSelectValue(e[o].children,t)),a)return a}}createDataTableTreeSelect(e,t){if(this.checkWrite()){let o=this.createTreeSelect(e),a=this;return o.onchange=function(){a.inputChanged.notify()},this.addProperties(e,o),o.value=t,o}{let o=this.findTreeSelectValue(e.select_values,t);return o||(o=""),document.createTextNode(o)}}createTreeSelect(e){let t=document.createElement("select"),o=document.createElement("option");o.value="null",o.appendChild(document.createTextNode("Select...")),t.appendChild(o);return this.addNestedSelectOptions(t,e.select_values,0),t}addNestedSelectOptions(e,t,o){t.forEach((t,a)=>{let i=document.createElement("option");i.value=t.value;let l=t.name;for(let e=0;e<o;e++)l="-"+(l=" "+(l=" "+l));i.appendChild(document.createTextNode(l)),e.appendChild(i),void 0!==t.children&&this.addNestedSelectOptions(e,t.children,o+1)})}createEditButton(){let e=this,t=document.createElement("button");return t.innerHTML="Edit",t.className="edit",t.onclick=function(){e.onEditClick.notify()},this.editButton=t,t}createCancelButton(){let e=document.createElement("button"),t=this;return e.innerHTML="Cancel",e.className="cancel",e.onclick=function(){t.onCancelClick.notify()},this.cancelButton=e,e}createDeleteButton(){let e=this,t=document.createElement("button");return t.innerHTML="Delete",t.onclick=function(){e.onDeleteClick.notify()},t.className="delete",this.deleteButton=t,t}createSaveButton(){let e=document.createElement("button");e.innerHTML="Save",e.className="save";let t=this;return e.onclick=function(){t.onSaveClick.notify()},this.saveButton=e,e}createNewButton(e){let t=document.createElement("button");t.className="btn-new";let o=this;return t.onclick=function(){window.location.href=o.model.td.route+"/create"},t.innerHTML='<i class="fa fa-plus" aria-hidden="true"></i>'+e,t}showWaitModal(e=!0){e?$(this.waitModal).modal("show"):$(this.waitModal).modal("hide")}showConfirmModal(e=!0){e?$(this.confirmModal).modal("show"):$(this.confirmModal).modal("hide")}hideErrorModal(){this.errorModal.hide()}showErrorModal(e){this.errorModal.addErrorMessage(e),this.errorModal.show()}}class c extends r{constructor(e){super(e)}createRecordTable(){return this.recordTableDiv=this.createRecordTableDiv(),this.table=this.createTableElement(),this.recordTableDiv.appendChild(this.table),this.recordTableDiv.appendChild(this.createButtons()),this.recordTableDiv.appendChild(this.waitModal),this.recordTableDiv.appendChild(this.confirmModal),this.recordTableDiv.appendChild(this.errorModal.createErrorModal()),this.updateTable(),this.recordTableDiv}createButtons(){let e=document.createElement("div");return e.id=this.id+"_buttons",e.className="record_table_buttons",this.edit_button_div=e,e}createRecordTableDiv(){let e=document.createElement("div");return e.className="record_table_div",e.id=this.name+"_table_div",e}createTableElement(){let e=document.createElement("table");return e.id=this.id,e.className="record_table",e}updateTable(){let e=this.table;e.innerHTML="",this.elements={},this.elements_array=[];let t=document.createElement("tbody");e.appendChild(t),this.tbody=t,this.cdo.forEach(e=>{switch(this.model.td.table_view){case"create":e.show_on_create&&this.addRow(t,e);break;case"edit":e.show_on_edit&&this.addRow(t,e);break;case"show":e.show_on_view&&this.addRow(t,e);break;default:console.log("error in the column definition")}}),this.updateButtons()}addRow(e,t){if("row_checkbox"!=t.type&&"row_number"!=t.type){let o=e.insertRow(),a=document.createElement("th"),i=t.db_field;t.caption&&(i=t.caption),a.innerHTML=i,o.appendChild(a);let l=this.model.tdo[0][t.db_field].data,n=o.insertCell(-1),d=this.createElement(l,t);this.elements[t.db_field]=d,this.elements_array.push(d),n.appendChild(d)}}}class h{constructor(e){this.model=e}findElement(e){let t,o,a=this.view.elements_array,i=a.find(function(o){return(t=o.indexOf(e))>-1});return[o=a.indexOf(i),t]}getElementRow(e){let t=e.name.substring("element_".length);return parseInt(t.substr(t.indexOf("r")+1,t.indexOf("c")-1))}getElementColumn(e){let t=e.name.substring("element_".length);return t.substr(t.indexOf("c")+1,t.length)}copyElementValueToModel(e,t,o,a=!1){if(this.view.checkWrite())if("row_checkbox"==t.type||"checkbox"==t.type||"radio"==t.type){let i=0;e.checked&&(i=1),!1===a?this.model.tdo[o][t.db_field].data=i:this.model.tdo[o][t.db_field].data[a]=i}else"text"!=t.type&&"number"!=t.type&&"password"!=t.type&&"select"!=t.type&&"tree_select"!=t.type&&"textarea"!=t.type&&"date"!=t.type||(!1===a?this.model.tdo[o][t.db_field].data=e.value:this.model.tdo[o][t.db_field].data[a]=e.value)}getPostData(){let e=[];return this.model.tdo.forEach((t,o)=>{e[o]={},this.cdo.forEach((a,i)=>{(void 0===a.post||a.post)&&(e[o][a.db_field]=t[a.db_field].data)})}),e}}class u{constructor(){}}class m extends u{constructor(e){super(e);let t=e.view;e.loadPageEvent=new n(e),e.loadPageEvent.attach(function(){console.log("load page event...")}),t.inputChanged=new n(t),e.view.inputChanged.attach(function(){console.log("input changed"),e.copyTable()}),t.individualSelectChanged=new n(t),e.view.individualSelectChanged.attach(function(){e.copyTable()}),t.onEditClick=new n(t),e.view.onEditClick.attach(function(){"function"==typeof e.model.options.onEditClick?(e.model.options.onEditClick(),console.log("using custom onEditClick"),console.log(e.model.options)):(console.log("using reg onEditClick"),e.model.td.table_view="edit",e.model.td.access="write",t.updateTable(),t.updateButtons(),e.setFocusToFirstInput())}),t.onCancelClick=new n(t),t.onCancelClick.attach(function(){switch(e.model.td.table_view){case"edit":e.model.loadOriginalData(),"on_page"==e.model.options.edit_display?(e.model.td.table_view="show",e.model.td.access="read",t.updateTable()):"modal"==e.model.options.edit_display?e.model.options.onCancelClick():"modal_only"==e.model.options.edit_display&&e.model.options.onCancelClick();break;case"create":"function"==typeof e.model.td.onCancelCreateClick?e.model.td.onCancelCreateClick():console.log("add onCancelCreateClick callback to option array")}}),t.onSaveClick=new n(t),e.view.onSaveClick.attach(function(){"function"==typeof e.model.options.onSaveClick&&e.model.options.onSaveClick()}),e.onSaveSuccess=new n(e),e.onSaveSuccess.attach(function(o,a){switch(console.log(e.model.td.table_view),e.model.td.table_view){case"create":"function"==typeof e.model.options.onCreateSaved?e.model.options.onCreateSaved(a.id):alert("add onCreate to table options");break;case"edit":"on_page"==e.model.options.edit_display?(console.log(a),e.model.td.table_view="show",e.model.td.access="read",e.model.original_data=e.getPostData(),t.updateTable()):"modal"==e.model.options.edit_display?e.model.options.onSaveSuccess(a.id):"modal_only"==e.model.options.edit_display&&(console.log(a),console.log(JSON.stringify(e.getPostData())),console.log(e.model.td.table_view),console.log(e.model.td.edit_display),console.log(JSON.stringify(e.model.tdo)),console.log(a.id),e.model.options.onSaveSuccess(a.id))}e.saveComplete.notify()}),e.saveComplete=new n(e),t.onDeleteClick=new n(t),t.onDeleteClick.attach(function(){e.getConfirm("Are you sure about that delete?",function(t){if(t){let t=e;e.view.showWaitModal(!0);let o={_method:"delete",data:{id:t.model.tdo[0].id.data}};"function"==typeof e.model.options.onDeleteClick&&e.model.options.onDeleteClick(),e.model.options.getData({method:"post",url:e.model.td.route,entity:o,onSuccess(o){t.view.showWaitModal(!1),"function"==typeof e.model.options.onDeleteSuccess&&e.model.options.onDeleteSuccess()},onError(e){}})}})})}}class p extends h{constructor(e,t){super(e),this.view=t,this.cdo=this.model.cdo,this.events=new m(this),0==this.model.tdo.length&&this.model.addNewRow()}updateCellValue(e,t,o=0){this.model.tdo[o][e].data=t,this.view.updateTable()}getSelectValueName(e,t){t=parseInt(t);let o=!1,a=this.model.getCDOColumnNumberFromName(e);return this.model.cdo[a].select_values.forEach(e=>{parseInt(e.value)==t&&(o=e.name)}),o}copyTable(){this.cdo.forEach(e=>{let t=this.view.elements[e.db_field];switch(this.model.td.table_view){case"create":e.show_on_create&&this.copyElementValueToModel(t,e,0);break;case"edit":e.show_on_edit&&this.copyElementValueToModel(t,e,0)}})}getConfirm(e,t){e=e||"",self=this,this.view.showConfirmModal(!0),$("#confirmMessage").html(e),$("#confirmFalse").click(function(){$(self.view.confirmModal).modal("hide"),t&&t(!1)}),$("#confirmTrue").click(function(){$(self.view.confirmModal).modal("hide"),t&&t(!0)})}setFocusToFirstInput(){let e=this.view.elements_array;for(let t=0;t<e.length;t++){if("text"==e[t].type||"number"==e[t].type||"textarea"==e[t].type||"date"==e[t].type){console.log("setting focus to"),console.log(e[t]),$(e[t]).focus();break}if("select-one"==e[t].type||"select-multi"==e[t].type){$(e[t]).focus();break}}}checkWrite(){let e=!1;return"WRITE"==this.model.td.access.toUpperCase()&&(e=!0),e}checkRead(){return!this.checkWrite()}}class f extends r{constructor(e){super(e),this.header_elements_array=[],this.header_elements={}}createCollectionTable(){return this.collectionTableDiv=this.createCollectionTableDiv(),this.table=this.createTable(),this.collectionTableDiv.appendChild(this.table),this.table_modify_div=this.createTableModifyButtons(),this.collectionTableDiv.appendChild(this.table_modify_div),this.edit_button_div=this.createEditButtonDiv(),this.collectionTableDiv.appendChild(this.edit_button_div),this.collectionTableDiv.appendChild(this.waitModal),this.collectionTableDiv.appendChild(this.confirmModal),this.collectionTableDiv.appendChild(this.errorModal.createErrorModal()),this.updateButtons(),this.updateTable(),this.collectionTableDiv}createCollectionTableDiv(){let e=document.createElement("div");return e.addEventListener("keyup",function(e){13==e.which&&console.log("enter pressed")}),e}createTable(){let e=document.createElement("table");return e.id=this.id,e.className="data_table",e.appendChild(this.createThead()),e.appendChild(this.createTotalsBody()),this.createTBody(),e.appendChild(this.tbody),e.appendChild(this.createTFoot()),e}createThead(){let e=document.createElement("thead");return this.thead=e,e}updateThead(){this.checkTHeaderArray(),this.thead.innerHTML="",this.header_elements_array=[];let e=[];for(let t=0;t<this.header_row_span;t++)e[t]=this.thead.insertRow();let t="";this.cdo.forEach(o=>{if(o.show_on_list&&(this.checkWrite()||"row_checkbox"!=o.type))if(void 0!==o.caption&&(t=o.caption),void 0!==o.array&&1==o.array)o.caption.forEach((t,a)=>{t.forEach(t=>{let i=document.createElement("th");i.innerHTML=t,void 0!==o.th_width&&(i.style.width=o.th_width),e[a].appendChild(i)})});else{let a=document.createElement("th"),i=this;a.col_def=o,a.id=o.db_field+"_header",a.sort=0,a.addEventListener("click",function(e){i.onHeaderClick.notify([e,a])});let l=document.createElement("p");l.innerHTML=t,a.appendChild(l);let n=document.createElement("i");n.className="fa fa-sort",a.appendChild(n),void 0!==o.th_width&&(a.style.width=o.th_width),a.rowSpan=this.header_row_span,e[0].appendChild(a),this.header_elements_array.push(a),this.header_elements[o.db_field]=a}}),this.updateHeaderSortView()}updateHeaderSortView(){let e=this;this.header_elements_array.forEach(e=>{e.classList.remove("thHighlight"),e.childNodes[1].className="fa fa-sort",e.sort=0}),this.model.sort.forEach(t=>{let o=Object.keys(t)[0],a=e.header_elements[o];switch(t[o]){case"asc":a.className="thHighlight",a.childNodes[1].className="fa fa-sort-asc",a.sort=1;break;case"desc":a.className="thHighlight",a.childNodes[1].className="fa fa-sort-desc",a.sort=2}})}checkTHeaderArray(){this.header_row_span=1,this.cdo.forEach((e,t)=>{e.show_on_list&&void 0!==e.array&&e.array&&(this.header_row_span=e.caption.length,this.array_col=t)})}createTotalsBody(){return this.total_tbody=document.createElement("tbody"),this.total_tbody.id=this.id+"_data_totals_tbody",this.total_tbody}updateTotalsBody(){this.total_tbody.innerHTML="";let e=!1;if(this.cdo.forEach(t=>{void 0!==t.total&&(e=!0)}),e){let e=this.total_tbody.insertRow();e.className="generalTableTotalsRow",e.style.backgroundColor="yellow";let t=!1,o=0;this.cdo.forEach(i=>{if(i.show_on_list&&(this.checkWrite()||"row_checkbox"!=i.type))if(void 0!==i.array&&i.array)i.caption[0].forEach((t,a)=>{e.insertCell(o);o++});else{let d=e.insertCell(o);if(d.id="tsrr0c"+o,o++,t||(d.innerHTML="TOTALS",t=!0),void 0!==i.total){var n=0;this.model.tdo.forEach(e=>{n+=l(e[i.db_field].data)}),d.innerHTML=a(n,i.total)}}})}}createTBody(){return this.tbody=document.createElement("tbody"),this.tbody.id=this.id+"_data_tbody",this.tbody}updateTBody(){this.tbody.innerHTML="",this.elements=[],this.elements_array=[],this.model.tdo.forEach((e,t)=>{this.elements[t]={},this.elements_array[t]=[];let o=this.tbody.insertRow(),a=0;this.cdo.forEach(i=>{if(i.show_on_list&&(this.checkWrite()||"row_checkbox"!=i.type)){let l=e[i.db_field].data;if(void 0!==i.array&&1==i.array)this.elements[t][i.db_field]=[],i.caption[0].forEach((e,n)=>{let d=o.insertCell(-1),s=this.createElement(l[n],i);s.name="element_r"+t+"c"+a,this.elements[t][i.db_field][n]=s,this.elements_array[t][a]=s,d.appendChild(s),a++});else{let e=o.insertCell(-1),n=this.createElement(l,i);n.name="element_r"+t+"c"+a,this.elements[t][i.db_field]=n,this.elements_array[t][a]=n,e.appendChild(n),a++}}})}),this.checkWrite()&&this.updateIndividualSelectOptions()}createTFoot(){let e=document.createElement("tfoot");return e.id=this.id+"_data_footer",this.tfoot=e,e}checkRows(e){for(let t,o=0;t=this.tbody.rows[o];o++)if(e.indexOf(o)>-1){let e=t.cells[0];void 0!==e.childNodes[0]&&"checkbox"==e.childNodes[0].type&&(e.childNodes[0].checked=!0)}}updateIndividualSelectOptions(){this.model.tdo.forEach((e,t)=>{this.cdo.forEach(o=>{if("select"==o.type&&void 0!==o.individual_select_options){let a=this.elements[t][o.db_field],i=this.model.getDbFieldArray(o.db_field);a.innerHTML="";let l=document.createElement("option");l.value="NULL",l.appendChild(document.createTextNode("Select...")),a.appendChild(l);let n=o.select_values,d=i.slice();d.splice(t,1);let s=[],r=[];n.forEach((e,t)=>{d.indexOf(e.value+"")<0&&(s.push(e.name),r.push(e.value))}),r.forEach((e,t)=>{(l=document.createElement("option")).value=r[t]+"",l.appendChild(document.createTextNode(s[t])),a.appendChild(l)}),a.value=e[o.db_field].data+""}})})}updateTable(){this.updateThead(),this.updateTBody(),this.updateTotalsBody(),this.updateButtons()}createTableModifyButtons(){let e=document.createElement("div");e.id=this.id+"_buttons",e.className="data_table_buttons";let t=document.createElement("div");t.className="data_table_modify_buttons",e.appendChild(t);let o,a=this,i=this.model.td.table_buttons;return i.includes("addRow")&&((o=document.createElement("button")).innerHTML="Add Row",o.addEventListener("click",function(){a.addRowClicked.notify()}),t.appendChild(o)),i.includes("deleteRow")&&((o=document.createElement("button")).innerHTML="Delete Row(s)",o.addEventListener("click",function(){a.deleteRowClicked.notify()}),t.appendChild(o)),i.includes("copyRows")&&((o=document.createElement("button")).innerHTML="Copy Row(s)",o.addEventListener("click",function(){a.copyRowClicked.notify()}),t.appendChild(o)),i.includes("moveRows")&&((o=document.createElement("button")).innerHTML="Move Row(s) Up",o.addEventListener("click",function(){a.moveRowUpClicked.notify()}),t.appendChild(o),(o=document.createElement("button")).innerHTML="Move Row(s) Down",o.addEventListener("click",function(){a.moveRowDownClicked.notify()}),t.appendChild(o)),i.includes("deleteAllRows")&&((o=document.createElement("button")).innerHTML="Delete All Rows",o.addEventListener("click",function(){a.deleteAllClicked.notify()}),t.appendChild(o)),i.includes("addColumn")&&((o=document.createElement("button")).innerHTML="Add Column",o.addEventListener("click",function(){a.addColumnClicked.notify()}),t.appendChild(o)),i.includes("deleteColumn")&&((o=document.createElement("button")).innerHTML="Delete Column",o.addEventListener("click",function(){a.deleteColumnClicked.notify()}),t.appendChild(o)),e}createEditButtonDiv(){let e=document.createElement("div");return e.className="data_table_edit_buttons",e}}class v extends u{constructor(e){super(e);let t=e.view;e.model;e.loadPageEvent=new n(e),t.deleteColumnClicked=new n(t),t.addRowClicked=new n(t),t.deleteRowClicked=new n(t),t.moveRowUpClicked=new n(t),t.moveRowDownClicked=new n(t),t.copyRowClicked=new n(t),t.deleteAllClicked=new n(t),t.makeTableWriteable=new n(t),t.makeTableReadable=new n(t),t.inputChanged=new n(t),t.individualSelectChanged=new n(t),t.dataTableChanged=new n(t),t.onEditClick=new n(t),e.view.onEditClick.attach(function(){console.log(e.model.options),"function"==typeof e.model.options.onEditClick?(console.log("hi thiere"),e.model.options.onEditClick()):(console.log("hi thiereeerer "),e.model.td.access="write",t.updateTable(),t.updateButtons())}),t.onCancelClick=new n(t),e.view.onCancelClick.attach(function(){e.model.loadOriginalData(),"on_page"==e.model.options.edit_display?(e.model.td.access="read",t.updateTable()):"modal"==e.model.options.edit_display?e.model.options.onCancelClick():"modal_only"==e.model.options.edit_display&&e.model.options.onCancelClick()}),t.onSaveClick=new n(t),e.view.onSaveClick.attach(function(){"function"==typeof e.model.options.onSaveClick&&e.model.options.onSaveClick()}),e.onSaveSuccess=new n(e),e.onSaveSuccess.attach(function(o,a){"on_page"==e.model.options.edit_display?(e.model.td.access="read",t.updateTable(),e.model.original_data=e.getPostData()):"modal"==e.model.options.edit_display?"function"==typeof e.model.options.onSaveSuccess&&e.model.options.onSaveSuccess(a.id):"modal_only"==e.model.options.edit_display&&(console.log(a),console.log(JSON.stringify(e.getPostData())),console.log(e.model.td.table_view),console.log(e.model.td.edit_display),console.log(JSON.stringify(e.model.tdo)),console.log(a.id),e.model.options.onSaveSuccess(a.id))});let o=e;t.onHeaderClick=new n(t),t.onHeaderClick.attach(function(t,o){console.log("collection table controller on sort"),e.uri.onSort(o);let a=e.uri.getUri();console.log("uri array"),console.log(a),"function"==typeof e.model.td.onSortClick&&e.model.td.onSortClick(e.uri.getUri()),e.model.sortData(),e.view.updateHeaderSortView(),e.view.updateTable()}),t.addColumnClicked=new n(t),e.view.addColumnClicked.attach(function(){e.model.addColumnToArray(e.view.array_col),e.view.updateTable()}),e.view.deleteColumnClicked.attach(function(){e.model.deleteColumnFromArray(e.view.array_col),e.view.updateTable()}),e.view.addRowClicked.attach(function(){e.addRow(),e.view.updateTable()}),e.view.deleteRowClicked.attach(function(e,t){o.deleteRow(t),o.view.updateTable()}),e.view.moveRowUpClicked.attach(function(){o.moveRowUp(),o.view.updateTable()}),e.view.moveRowDownClicked.attach(function(){o.moveRowDown(),o.view.updateTable()}),e.view.copyRowClicked.attach(function(){o.copyRow(),o.view.updateTable()}),e.view.deleteAllClicked.attach(function(e){o.deleteAllRows(e),o.view.updateTable()}),e.view.inputChanged.attach(function(){console.log("inputChanged Event...  copyTable then updateTotalsBody ... then the cd event"),o.copyTable(),o.view.updateTotalsBody()}),e.view.individualSelectChanged.attach(function(){o.copyTable(),o.view.updateIndividualSelectOptions(),o.view.inputChanged.notify()})}}class b{constructor(e){this.controller=e;let t=e.model.td.name;this.stored_search_key=t+"_search",this.stored_sort_key=t+"_sort"}getUri(){let e=this.getSortUri(),t=this.getSearchUrlData();return Object.assign(t,e)}getSearchUrlData(){let e={};return this.controller.view.search_elements.forEach(t=>{e[t.name]=t.value}),e.table_name=this.controller.view.name,e}checkUri(e){let t=new JsUri(e);for(let e=0;e<this.controller.view.search_elements.length;e++)if(t.getQueryParamValue(this.controller.view.search_elements[e].name))return!0;return!1}loadFromUri(e){console.log("loading from uri"),this.loadSearchValuesFromUri(e),this.loadSortFromUri(e)}loadSearchValuesFromUri(e){let t=new JsUri(e);this.controller.view.search_elements.forEach(e=>{t.getQueryParamValue(e.name)&&(e.value=t.getQueryParamValue(e.name))})}onSort(e,t){let o=e[0],a=e[1],i=["none","asc","desc"],l=a.sort;l=++l%i.length,a.sort=l;let n=a.col_def.db_field,d=this;switch(o.shiftKey||this.controller.view.header_elements_array.forEach(e=>{a!=e&&d.removeSort(e.col_def.db_field)}),console.log("sort array: "+i[l]),i[l]){case"none":this.removeSort(n);break;case"asc":this.addSort(n,"asc");break;case"desc":this.removeSort(n),this.addSort(n,"desc")}sessionStorage[this.stored_sort_key]=JSON.stringify(this.controller.model.sort)}getSortUri(){let e={};return this.controller.model.sort.forEach(t=>{let o=Object.keys(t);e[this.controller.view.name+"_"+o[0]+"_sort"]=t[o[0]]}),e}loadSortFromUri(e){let t=this;new JsUri(e).queryPairs.forEach(e=>{let o=e[0];if(o.includes("_sort")){o=(o=o.replace("_sort","")).substring(this.controller.view.name.length+1,o.length);let a=e[1];t.addSort(o,a)}})}checkStorage(){return window.storage[this.stored_search_key]}retrieveSearch(){return JSON.parse(window.storage[this.stored_search_key])}storeSearch(){let e=this.controller.getSearchFormValues();window.storage[this.stored_search_key]=JSON.stringify(e)}loadSearchFromStorage(){console.log("loading search values from storage"),console.log(window.storage[this.stored_search_key]);let e=this.retrieveSearch();return this.controller.view.search_elements.forEach(t=>{e[t.name]&&(t.value=e[t.name])}),e}addSort(e,t){let o={};o[e]=t,this.controller.model.sort.push(o)}loadSortFromStorage(){window.storage[this.stored_sort_key]&&(this.controller.model.sort=JSON.parse(window.storage[this.stored_sort_key]))}removeSort(e){this.controller.model.sort=this.controller.model.sort.filter(function(t){return Object.keys(t)[0]!==e})}onReset(){delete window.storage[this.stored_search_key],delete window.storage[this.stored_sort_key],this.resetStoredSort(),"function"==typeof this.controller.model.options.onResetClick&&this.controller.model.options.onResetClick()}resetStoredSort(){this.controller.model.sort=[]}}class _ extends h{constructor(e,t){super(e),this.view=t,this.cdo=this.model.cdo,this.uri=new b(this),this.collectionTableEvents=new v(this)}addRow(){this.copyTable(),this.model.addNewRow()}deleteRow(e=!0){if((!e||confirm("Confirm Delete Row(s)"))&&this.model.tdo.length>0){let e=this.findCheckedRows();e.length>0&&(this.copyTable(),this.model.deleteRows(e))}}copyRow(){this.copyTable();let e=this.findCheckedRows();e.length>0&&this.model.copyRows(e)}moveRowUp(){let e=this.findCheckedRows(),t=!0;for(let o=0;o<e.length;o++)e[o]-1<0&&(t=!1);if(t){this.copyTable();for(let t=0;t<e.length;t++)this.model.moveRow(e[t],e[t]-1)}}moveRowDown(){let e=this.findCheckedRows(),t=!0;for(let o=0;o<e.length;o++)e[o]+1>this.model.tdo.length-1&&(t=!1);if(t){this.copyTable();for(let t=e.length-1;t>-1;t--){let o=parseInt(e[t])+parseInt(1);this.model.moveRow(e[t],o)}}}deleteAllRows(){confirm("Confirm Delete All Rows")&&this.model.DeleteAllRows()}findCheckedRows(){let e=this.view.tbody,t=e.rows.length,o=new Array,a=0;for(let i=0;i<t;i++){let t=e.rows[i].cells[0].childNodes[0];null!=t&&1==t.checked&&(o[a]=i,a+=1)}return o}copyTable(){let e=this.view.tbody.rows.length;for(let t=0;t<e;t++)this.cdo.forEach(e=>{if(e.show_on_list)if(void 0!==e.array&&e.array)e.caption[0].forEach((o,a)=>{let i=this.view.elements[t][e.db_field][a];this.copyElementValueToModel(i,e,t,a)});else{let o=this.view.elements[t][e.db_field];this.copyElementValueToModel(o,e,t)}})}setFocusToFirstInputOfRow(e){let t=this.view.elements_array[e];for(let e=0;e<t.length;e++)if("text"==t[e].type||"number"==t[e].type){t[e].focus(),t[e].select();break}}validateDynamicTableObject(){for(errors="",i=0;i<this.cdo.length;i++)if(void 0!==this.cdo[i].db_field&&void 0!==this.cdo[i].validate){var e=document.getElementsByName(this.cdo[i].db_field+"[]");for(el=0;el<e.length;el++)void 0!==this.cdo[i].validate.not_blank_or_zero_or_false_or_null?""!=e[el].value&&0!=round2(e[el].value,0)&&"false"!=e[el].value&&"NULL"!=e[el].value||(errors+="Bad Value For "+this.cdo[i].caption+" Row "+(el+1)+newline()):void 0!==this.cdo[i].validate.acceptable_values&&(acceptable_values=this.cdo[i].validate.acceptable_values[0],"number"==acceptable_value?isNaN(e[el].value)&&(errors+=this.cdo[i].db_field+" needs to be a value."+newline(),e[el].focus()):"text"==acceptable_values||acceptable_values)}return""==errors?(needToConfirm=!1,document.getElementById("submit")&&(document.getElementById("submit").disabled=!0),!0):(alert(errors),needToConfirm=!0,!1)}getTableArrayColumnNumberFromHTMLColumnNumber(e){let t=0,o=0;for(i=0;i<this.cdo.length;i++)if(this.cdo[i].show_on_list||(o+=1),t+=1,e==o)return t;return-1}setChecks(e,t){let o=this.view.tbody;o.rows[e].cells[0].childNodes[0].checked=!1,o.rows[t].cells[0].childNodes[0].checked=!0}}function w(e,t){let o=!1;for(let a=0;a<t.length;a++)t[a]==e&&(o=!0);return o}class y{constructor(e){this.original_data=e.data,this.options=e,this.td=this.table_definition=e,this.tdo=[],this.data=this.tdo,this.rdo={},this.cdo=this.options.column_definition,this.sort=[],this.modelChanged=new n(this),this.newRow=new n(this);let t=this;this.modelChanged.attach(function(){t.updateTableObjectLineNumbers()}),this.loadData(e.data)}loadOriginalData(){this.loadData(this.original_data)}loadData(e){this.tdo=[];for(let t=0;t<e.length;t++)this.addDataRow(e[t]);this.sortData(),this.original_data=e}dynamicSort(e){let t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(o,a){return(o[e].data<a[e].data?-1:o[e].data>a[e].data?1:0)*t}}sortData(){let e=firstBy(function(e,t){return 0});this.sort.forEach(t=>{let o=Object.keys(t),a=o[0];e="asc"==t[o[0]]?e.thenBy(function(e){return e[a].data}):e.thenBy(function(e){return e[a].data},-1)}),this.tdo.sort(e)}addDataRow(e){let t=this.addNewRow();return this.cdo.forEach(o=>{this.addItem(o,e,t)}),this.updateTableObjectLineNumbers(),this.modelChanged.notify(),t}addNewRow(){let e=this.rowCount();return this.tdo[e]={},this.tdo[e]._row=this.rdo,this.tdo[e]._parent={},this.cdo.forEach(t=>{let o="";if(void 0!==t.default_value&&(o=t.default_value),void 0!==t.array&&1==t.array){let a=[];this.tdo[e][t.db_field]={},t.caption[0].forEach((e,t)=>{a[t]=o}),this.tdo[e][t.db_field].data=a,this.tdo[e][t.db_field].cell={}}else this.tdo[e][t.db_field]={},this.tdo[e][t.db_field].data=o,this.tdo[e][t.db_field].cell={}}),this.modelChanged.notify(),this.newRow.notify(),e}addItem(e,t,o){let a="";a=void 0!==t[e.db_field]?t[e.db_field]:void 0!==e.default_value?e.default_value:"",void 0!==e.row_number?a=this.tdo.length:(this.tdo[o][e.db_field]={},this.tdo[o][e.db_field].data=a,this.tdo[o][e.db_field].cell={})}updateTableObjectLineNumbers(){if(-1!=this.getCDOColumnNumberFromName("row_number"))for(let e=0;e<this.tdo.length;e++)this.tdo[e].row_number.data=e+1}getCDOColumnNumberFromName(e){let t=-1;return this.cdo.forEach((o,a)=>{void 0!==o.db_field&&o.db_field==e&&(t=a)}),t}rowCount(){return this.tdo.length}copyRows(e,t="bottom"){let o=0,a=[];this.tdo.forEach((t,i)=>{a[o]=JSON.parse(JSON.stringify(t)),o++,w(i,e)&&(a[o]=JSON.parse(JSON.stringify(t)),o++)}),this.tdo=a,this.modelChanged.notify()}moveRow(e,t){let o=[];for(let a=0;a<this.tdo.length;a++)o[a]=e==a?this.tdo[t]:t==a?this.tdo[e]:this.tdo[a];this.tdo=o,this.modelChanged.notify()}deleteRows(e){this.modelChanged.notify();let t=0,o=[];for(let a=0;a<this.tdo.length;a++)w(a,e)||(o[t]=this.tdo[a],t++);this.tdo=o,this.modelChanged.notify()}DeleteAllRows(){this.tdo=[],this.modelChanged.notify()}getDbFieldArray(e){let t=[];return this.tdo.forEach(o=>{t.push(o[e].data+"")}),t}addColumnToArray(e){this.cdo[e].caption.forEach(e=>{e.push("")});let t=this.cdo[e].db_field;this.tdo.forEach(e=>{e[t].data.push(""),console.log(e[t].data)}),this.modelChanged.notify()}deleteColumnFromArray(e){this.cdo[e].caption.forEach(e=>{e.pop()});let t=this.cdo[e].db_field;this.tdo.forEach(e=>{e[t].data.pop()}),this.modelChanged.notify()}}class g extends f{constructor(e){super(e)}createSearchTable(){return this.searchDiv=this.createSearchDiv(),this.searchTableElement=this.createSearchTableElement(),this.searchDiv.appendChild(this.searchTableElement),this.searchThead=this.createSearchThead(),this.searchTableElement.appendChild(this.searchThead),this.searchTbody=this.createSearchTbody(),this.searchTableElement.appendChild(this.searchTbody),this.updateSearchTable(),this.searchDiv.appendChild(this.createSearchButtons()),this.searchDataTableDiv=this.createDataTableDiv(),this.searchDiv.appendChild(this.searchDataTableDiv),this.searchDiv}createSearchButtons(){let e=this;return this.searchButtonDiv=document.createElement("div"),this.searchButtonDiv.className="search_buttons",this.searchButton=document.createElement("button"),this.searchButton.className="search",this.searchButton.onclick=function(){e.searchClicked.notify()},this.searchButton.innerHTML='<i class="fa fa-binoculars" aria-hidden="true"></i><p>Search</p>',this.searchButtonDiv.appendChild(this.searchButton),this.searchResetButton=document.createElement("button"),this.searchResetButton.onclick=function(){e.resetClicked.notify()},this.searchResetButton.innerHTML="<p>Reset</p>",this.searchResetButton.className="reset",this.searchButtonDiv.appendChild(this.searchResetButton),this.searchButtonDiv}updateSearchTable(){this.updateSearchThead(this.searchThead),this.updateSearchTbody(this.searchTbody)}createSearchDiv(){let e=document.createElement("div"),t=this;return e.addEventListener("keyup",function(e){13==e.which&&(console.log("enter pressed"),t.searchClicked.notify())}),e}createSearchTableElement(){let e=document.createElement("table");return e.id=this.id+"_search",e.className="search_table",e}createSearchThead(){let e=document.createElement("thead");return e.id=this.id+"_search_thead",e}createSearchTbody(){let e=document.createElement("tbody");return e.id=this.id+"_search_tbody",e}createDataTableDiv(){return document.createElement("div")}updateSearchThead(e){let t=e.insertRow();this.cdo.forEach(e=>{if(void 0!==e.search){let o="";void 0!==e.th_width&&(o=e.th_width);let a="";if(void 0!==e.caption&&(a=e.caption),"date"==e.type){let e=document.createElement("th");e.innerHTML=a+" Start Date",e.style.width=o,t.appendChild(e);let i=document.createElement("th");e.style.width=o,i.innerHTML=a+" END Date",t.appendChild(i)}else{let e=document.createElement("th");e.innerHTML=a,e.style.width=o,t.appendChild(e)}}})}updateSearchTbody(e){let t=e.insertRow(),o=0;this.search_elements=[],this.cdo.forEach(e=>{if(void 0!==e.search){let a=t.insertCell(o);if(a.id="sr0sc"+o,o++,"date"==e.type){let i=document.createElement("input");i.type="date",i.name=this.name+"_"+e.db_field+"_date_start",a.appendChild(i),this.search_elements.push(i),e.search_element=[],e.search_element[0]=i,(a=t.insertCell(o)).id="sr0sc"+o,o++;let l=document.createElement("input");l.type="date",l.name=this.name+"_"+e.db_field+"_date_end",a.appendChild(l),this.search_elements.push(l),e.search_element[1]=i}else if("checkbox"==e.type){let t=document.createElement("select");t.name=this.name+"_"+e.db_field;let o=document.createElement("option");o.value="null",o.appendChild(document.createTextNode("Either")),t.appendChild(o),(o=document.createElement("option")).value="1",o.appendChild(document.createTextNode("Checked")),t.appendChild(o),(o=document.createElement("option")).value="0",o.appendChild(document.createTextNode("Not Checked")),t.appendChild(o),a.appendChild(t),this.search_elements.push(t),e.search_element=t}else if("select"==e.type){let t=this.createSelect(e);t.name=this.name+"_"+e.db_field,a.appendChild(t),this.search_elements.push(t),e.search_element=t}else if("tree_select"==e.type){let t=this.createTreeSelect(e);t.name=this.name+"_"+e.db_field,a.appendChild(t),this.search_elements.push(t),e.search_element=t}else{let t=document.createElement("input");t.type=e.type,t.name=this.name+"_"+e.db_field,a.appendChild(t),this.search_elements.push(t),e.search_element=t}}})}addMessageInsteadOfTable(e){let t=document.createElement("div");t.innerHTML=e,this.searchDataTableDiv.innerHTML="",this.searchDataTableDiv.appendChild(t)}addDataTable(){this.searchDataTableDiv.innerHTML="",this.searchDataTableDiv.appendChild(this.createCollectionTable())}destroyCollectionTable(){this.searchDataTableDiv.innerHTML=""}searching(){this.addMessageInsteadOfTable("searching...")}}class C{constructor(e){e.searchReturned=new n(e),e.searching=new n(e),e.view.searchClicked=new n(e.view),e.view.resetClicked=new n(e.view),e.view.searchClicked.attach(function(){e.uri.storeSearch();let t=e.uri.getSearchUrlData();"function"==typeof e.model.td.onSearchClick&&e.model.td.onSearchClick(t)}),e.searching.attach(function(){}),e.searchReturned.attach(function(t,o){e.onSearchReturned(o)}),e.loadPageEvent=new n(e),e.loadPageEvent.attach(function(){if(e.uri.checkUri(e.model.options.search_query))console.log("there is data on the uri"),"function"==typeof e.model.options.onLoadPageStart&&e.model.options.onLoadPageStart(),e.uri.loadFromUri(e.model.options.search_query),e.uri.storeSearch(),"function"==typeof e.model.options.onSearching&&e.model.options.onSearching(),e.getAndRenderSearch();else if(e.uri.checkStorage()){console.log("loading search from storage");let t=e.uri.loadSearchFromStorage();e.uri.loadSortFromStorage(),"function"==typeof e.model.options.loadPageFromStorage&&e.model.options.loadPageFromStorage(t)}else if(console.log("no search set, populate defaults then get records"),e.populateSearchValuesFromDefaultValues(),e.model.options.number_of_records_available<=e.model.options.number_of_records_to_automatically_get)e.getAndRenderSearch();else{let t="There are "+e.model.options.number_of_records_available+" records available, please search to limit the results.";e.view.addMessageInsteadOfTable(t),e.setFocusToFirstInputOfSearch()}}),e.view.resetClicked.attach(function(){e.onReset()})}}class T extends _{constructor(e,t){super(e,t);this.show_records_autmatically_below=50,this.number_of_records_available=e.options.number_of_records_available,this.searchTableEvents=new C(this)}getSearchPostData(){let e={search_fields:{}};return e.table_name=this.view.name,this.view.search_elements.forEach(t=>{e.search_fields[t.name]=t.value}),console.log("I need controller for testing.... search post data"),console.log(JSON.stringify(e)),e}onSearchReturned(e){let t=e.data;this.number_of_records_available=t.length,this.model.loadData(t),this.loadInitialData()}loadInitialData(){this.number_of_records_available>0&&0==this.model.tdo.length?this.number_of_records_available<this.show_records_autmatically_below?this.view.searchClicked.notify():this.view.addMessageInsteadOfTable(`There are ${this.number_of_records_available} records available... please search to see the data. To sort data returned click on the column header. You may also use shift+click for multiple column sorting.`):0==this.number_of_records_available&&0==this.model.tdo.length?this.view.addMessageInsteadOfTable("There are 0 records available."):(this.view.addDataTable(),this.setFocusToFirstInputOfSearch())}populateSearchValuesFromDefaultValues(){this.model.cdo.forEach(e=>{void 0!==e.search&&void 0!==e.search_default&&("date"==e.type?(e.search_element[0].value=e.search_default,e.search_element[1].value=e.search_default):e.search_element.value=e.search_default)})}getAndRenderSearch(){let e=this;e.model.options.getData({method:"post",url:"/"+e.model.options.search_route,entity:e.getSearchPostData(),onSuccess:function(t){e.model.loadData(t.data.records),t.data.records.length>0?(e.view.addDataTable(),e.setFocusToFirstInputOfSearch()):(e.view.addMessageInsteadOfTable("There are no search results"),e.setFocusToFirstInputOfSearch()),"function"==typeof e.model.options.onLoadPageComplete&&e.model.options.onLoadPageComplete(),e.setFocusToFirstInputOfSearch()}})}onReset(){this.view.search_elements.forEach(e=>{switch(e.type){case"tree_select":case"select-multiple":case"select-one":e.value="null";break;default:e.value=""}}),this.setFocusToFirstInputOfSearch(),this.view.addMessageInsteadOfTable("Press search to display results"),this.uri.onReset()}getSearchFormValues(){let e={},t=this.view.name+"_search";return this.view.search_elements.forEach(o=>{switch(o.type){case"text":case"number":case"date":t=o.name,e[t]=o.value,o.value;break;case"tree_select":case"select-multiple":case"select-one":t=o.name,e[t]=o.value,o.value}}),e}setFocusToFirstInputOfSearch(){"input"===this.view.search_elements[0].nodeName.toLowerCase()?(this.view.search_elements[0].focus(),this.view.search_elements[0].select()):"select"===this.view.search_elements[0].nodeName.toLowerCase()?(console.log("select......."),this.view.search_elements[0].focus()):(this.view.search_elements[0].focus(),this.view.search_elements[0].select())}}o.d(t,"AwesomeTable",function(){return E});class E{constructor(e){let t=function(t,o){void 0===e[t]&&(e[t]=o)};t("access","read"),t("edit_display","on_page"),this.options=e}clone(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var o=0,a=e.length;o<a;o++)t[o]=this.clone(e[o]);return t}if(e instanceof Object){for(var i in t={},e)e.hasOwnProperty(i)&&(t[i]=this.clone(e[i]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}addTo(e){switch(this.div=document.getElementById(e),this.options.type){case"record":this.recordTable();break;case"collection":this.collectionTable();break;case"searchable":this.searchableTable();break;default:console.log("missed the type in the table definition")}}recordTable(){let e=new y(this.options),t=new c(e),o=new p(e,t),a=this.clone(this.options);a.name=a.name+"_modal";let i=new y(a),l=new c(i),n=new p(i,l);this.model=e,this.view=t,this.controller=o,this.modelModal=i,this.viewModal=l,this.controllerModal=n;let d=this;switch($(l.formModal.modal_div).on("shown.bs.modal",function(){let e=$(l.formModal.modal_div).find(":input:first");e.focus(),e.select()}),this.options.edit_display){case"on_page":this.div.appendChild(t.createRecordTable()),e.options.onSaveClick=function(){let a={data:o.getPostData(),_method:"put"};void 0!==i.options.additionalPostValues&&(a.additional_post_values=i.options.additionalPostValues),t.showWaitModal(!0),console.log(JSON.stringify(a)),d.options.getData({method:"post",url:o.model.td.route,entity:a,onSuccess(a){e.original_data=o.getPostData(),t.showWaitModal(!1),o.onSaveSuccess.notify(a)},onError(e){t.showWaitModal(!1),t.showErrorModal(e.message)}})};break;case"modal":l.inputChanged.attach(function(){e.tdo=i.tdo,t.updateTable()}),this.div.appendChild(t.createRecordTable()),this.div.appendChild(l.createModalTable(l.createRecordTable())),e.options.onEditClick=function(){i.td.access="write",i.td.table_view="edit",l.showModalTable(),l.updateTable()},i.options.onSaveClick=function(){let t={data:o.getPostData(),_method:"put"};void 0!==i.options.additionalPostValues&&(t.additional_post_values=i.options.additionalPostValues),l.showWaitModal(!0),console.log(JSON.stringify(t)),d.options.getData({method:"post",url:o.model.td.route,entity:t,onSuccess(t){e.original_data=o.getPostData(),l.showWaitModal(!1),l.hideModalTable(),o.onSaveSuccess.notify(t)},onError(e){l.showWaitModal(!1),l.showErrorModal(e.message)}})},i.options.onSaveSuccess=function(){l.hideModalTable(),e.tdo=i.tdo,t.updateTable()},i.options.onCancelClick=function(){e.loadOriginalData(),t.updateTable(),l.hideModalTable()};break;case"modal_only":this.modelModal.options.onEditClick=function(){alert("why is there an edit button on the modal")},this.modelModal.options.onCancelClick=function(){d.viewModal.hideModalTable()},this.div.appendChild(this.viewModal.createModalTable(this.viewModal.createRecordTable()))}}setValue(e,t,o){"on_page"==this.options.edit_display?this.controller.updateCellValue(e,o,t):this.controllerModal.updateCellValue(e,o,t)}getValue(e,t){return"on_page"==this.options.edit_display?this.model.tdo[t][e].data:this.modelModal.tdo[t][e].data}getSelectName(e,t){return this.controller.getSelectValueName(e,t)}collectionTable(){let e=this,t=new y(this.options),o=new f(t),a=new _(t,o),i=new y(this.clone(this.options)),l=new f(i);new _(i,l);switch($(l.formModal.modal_div).on("shown.bs.modal",function(){let e=$(l.formModal.modal_div).find(":input:first");e.focus(),e.select()}),l.inputChanged.attach(function(){t.tdo=i.tdo,o.updateTable()}),this.options.edit_display){case"on_page":this.div.appendChild(this.view.createCollectionTable()),t.options.onSaveClick=function(){let l={data:a.getPostData(),_method:"put"};void 0!==i.options.additionalPostValues&&(l.additional_post_values=i.options.additionalPostValues),o.showWaitModal(!0),console.log(JSON.stringify(l)),console.log(e.options),e.options.getData({method:"post",url:a.model.td.route,entity:l,onSuccess(e){t.original_data=a.getPostData(),o.showWaitModal(!1),a.onSaveSuccess.notify(e)},onError(e){o.showWaitModal(!1),o.showErrorModal(e.responseJSON.message)}})};break;case"modal":this.div.appendChild(o.createCollectionTable()),this.div.appendChild(l.createModalTable(l.createCollectionTable())),i.options.onSaveClick=function(){let n={data:a.getPostData(),_method:"put"};void 0!==i.options.additionalPostValues&&(n.additional_post_values=i.options.additionalPostValues),l.showWaitModal(!0),console.log(JSON.stringify(n)),console.log(e),e.options.getData({method:"post",url:a.model.td.route,entity:n,onSuccess(e){t.original_data=a.getPostData(),l.showWaitModal(!1),l.hideModalTable(),a.onSaveSuccess.notify(e)},onError(e){l.showWaitModal(!1),o.showErrorModal(e.responseJSON.message)}})},t.options.onEditClick=function(){i.td.access="write",i.td.table_view="edit",l.showModalTable(),l.updateTable()},i.options.onSaveSuccess=function(){l.hideModalTable(),t.tdo=i.tdo,o.updateTable()},i.options.onCancelClick=function(){t.loadOriginalData(),o.updateTable(),l.hideModalTable()};break;case"modal_only":i.options.onEditClick=function(){alert("why is there an edit button on the modal")},i.options.onCancelClick=function(){l.hideModalTable()},this.div.appendChild(l.createModalTable())}}searchableTable(){let e=new y(this.options),t=new g(e),o=new T(e,t);this.searchController=o;let a=t.createSearchTable();this.div.appendChild(a),$(function(){o.loadPageEvent.notify()})}updateSearchPage(){this.searchController.loadPageEvent.notify()}removeResultsTable(){this.searchController.view.destroyCollectionTable()}}}]);